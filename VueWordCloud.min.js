(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b(require('vue')):'function'==typeof define&&define.amd?define(['vue'],b):a.VueWordCloud=b(a.Vue)})(this,function(a){'use strict';var b=Math.floor,c=Math.min;a=a&&a.hasOwnProperty('default')?a['default']:a;let d=class extends Error{constructor(...a){super(...a),this.name='InterruptError'}},e=function(a){let b=new Blob([a]),c=URL.createObjectURL(b);return new Worker(c)},f=function(a){return new Promise(function(b,c){let d,e=function(a){d(a),b(a.data)},f=function(a){d(a),c(a)};d=function(b){b.preventDefault(),a.removeEventListener('message',e),a.removeEventListener('error',f)},a.addEventListener('message',e),a.addEventListener('error',f)})},g=function(a=1){return new Promise((b)=>setTimeout(b,a))},h=function(a,b){let c=new Set;return a.filter((a)=>(a=b(a),!c.has(a))&&(c.add(a),!0))},i=function(a,b){let d=Infinity;for(let e of a)d=c(b(e),d);return d},j=function(a,b){let c=-Infinity;for(let d of a)c=Math.max(b(d),c);return c},k=function(a){return 2*a*Math.PI},l=function(a,b,c=1,d,e){const f=a,g=c,h=b;if(d===e)return d;if(g===h)return f<=g?d:e;let i=f;return i=(i-g)/(h-g),i=i*(e-d)+d,i},m={render(a){return this.renderer(a)},props:{words:{type:Array,default(){return[]}},text:{type:[String,Function],default:''},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default(){let a=[0,0.75];return function(){return a[b(Math.random()*a.length)]}}},fontFamily:{type:[String,Function],default:'serif'},fontStyle:{type:[String,Function],default:'normal'},fontVariant:{type:[String,Function],default:'normal'},fontWeight:{type:[String,Function],default:'normal'},color:{type:[String,Function],default:'Black'},fontSizeRatio:{type:Number},maxFontSize:{type:Number,default:Infinity},animationDuration:{type:Number,default:5e3},animationEasing:{type:String,default:'ease'},containerSizeUpdateInterval:{type:Number,default:1e3}},data(){return{containerWidth:0,containerHeight:0,fulfilledBoundedWords:[]}},mounted(){this.startContainerSizeUpdate()},computed:{renderer(){return this.domRenderer},normalizedWords(){let a=this.words.map((a)=>{let b,c,d,e,f,g,h,i;if(a)switch(typeof a){case'string':{b=a;break}case'object':{Array.isArray(a)?[b,c]=a:({text:b,weight:c,rotation:d,fontFamily:e,fontStyle:f,fontVariant:g,fontWeight:h,color:i}=a);break}}return void 0===b&&('function'==typeof this.text?b=this.text(a):b=this.text),void 0===c&&('function'==typeof this.weight?c=this.weight(a):c=this.weight),void 0===d&&('function'==typeof this.rotation?d=this.rotation(a):d=this.rotation),void 0===e&&('function'==typeof this.fontFamily?e=this.fontFamily(a):e=this.fontFamily),void 0===f&&('function'==typeof this.fontStyle?f=this.fontStyle(a):f=this.fontStyle),void 0===g&&('function'==typeof this.fontVariant?g=this.fontVariant(a):g=this.fontVariant),void 0===h&&('function'==typeof this.fontWeight?h=this.fontWeight(a):h=this.fontWeight),void 0===i&&('function'==typeof this.color?i=this.color(a):i=this.color),{text:b,weight:c,rotation:d,fontFamily:e,fontStyle:f,fontVariant:g,fontWeight:h,color:i}});a=a.filter(({text:a})=>a),a=a.filter(({weight:a})=>0<a),a=h(a,({text:a})=>a),a.sort((a,b)=>b.weight-a.weight);let b=i(a,({weight:a})=>a),c=j(a,({weight:a})=>a);if(this.fontSizeRatio)for(let d of a)d.weight=l(d.weight,c,b,1,this.fontSizeRatio);else for(let c of a)c.weight/=b;return a},boundedWords(){return(async()=>{try{this.fulfilledBoundedWords=await this.promisedBoundedWords}catch(a){}})(),this.fulfilledBoundedWords},promisedBoundedWords(){return this.computeBoundedWords()},computeBoundedWords:function(){let a=async function(a,b,c,d,e,f,g){var h=Math.ceil,i=Math.sin,j=Math.abs,l=Math.cos;g=k(g);let m=[d,e,f,`${c}px`,b].join(' ');try{await document.fonts.load(m,a)}catch(a){}let n=document.createElement('canvas').getContext('2d');n.font=m;let o=n.measureText(a).width,p=c,q=h(o*j(l(g))+p*j(i(g))),r=h(o*j(i(g))+p*j(l(g))),s=new Uint8Array(q*r);if(0<s.length){let b=document.createElement('canvas').getContext('2d');b.canvas.width=q,b.canvas.height=r,b.translate(q/2,r/2),b.rotate(g),b.font=m,b.textAlign='center',b.textBaseline='middle',b.fillText(a,0,0);let c=b.getImageData(0,0,q,r).data;for(let a=0,b=s.length;a<b;++a)s[a]=c[4*a+3]}return{textWidth:o,textHeight:p,rectWidth:q,rectHeight:r,rectData:s}},c=async function(c){let d=this.containerWidth,g=this.containerHeight;if(0>=d||0>=g)return[];let h=this.normalizedWords;await c.delayIfNotInterrupted();let i=[],j=e("(function(){'use strict';let a=function*(a,b){var c=Math.ceil,d=Math.floor;if(0<a&&0<b){let e,f;a>b?(e=1,f=b/a):b>a?(f=1,e=a/b):e=f=1;let g=d(a/2),h=d(b/2),i=a-g,j=b-h;if(g<i)for(let a=g;a<=i;++a)yield[a,h];else if(h<j)for(let a=h;a<=j;++a)yield[g,a];for(let k=g,l=h,m=i,n=j;i<a||j<b;){g-=e,h-=f,i+=e,j+=f;let a=d(g),b=d(h),o=c(i),p=c(j);if(o>m)for(let a=b;a<p;++a)yield[o,a];if(p>n)for(let b=o;b>a;--b)yield[b,p];if(a<k)for(let c=p;c>b;--c)yield[a,c];if(b<l)for(let c=a;c<o;++c)yield[c,b];k=a,l=b,m=o,n=p}}},b=class{constructor(){this._values=[]}enqueue(a){this._values.push(a),this._promise&&this._resolvePromise()}async dequeue(){for(;;){if(this._values.length)return this._values.shift();this._promise||(this._promise=new Promise((a)=>{this._resolvePromise=a})),await this._promise,this._promise=void 0}}};(async function(){let c=new b;this.addEventListener('message',function({data:a}){c.enqueue(a)});let{gridWidth:d,gridHeight:e}=await c.dequeue(),f=new Uint8Array(d*e);for(;;){let{rectWidth:b,rectHeight:g,rectData:h}=await c.dequeue(),i=[];for(let a=0;a<b;++a)for(let c=0;c<g;++c)h[b*c+a]&&i.push([a,c]);this.postMessage((()=>{for(let[c,h]of a(d-b,e-g))if((()=>{let a=[];for(let[b,e]of i){if(b+=c,e+=h,f[d*e+b])return!1;a.push([b,e])}for(let[b,c]of a)f[d*c+b]=1;return!0})())return{rectLeft:c,rectTop:h};throw new Error})())}}).call(self)})();\n");try{let e=4194304,k=b(Math.sqrt(d/g*e)),l=b(e/k);j.postMessage({gridWidth:k,gridHeight:l});for(let b of h){c.throwIfInterrupted();try{let{text:c,weight:d,rotation:e,fontFamily:g,fontStyle:h,fontVariant:k,fontWeight:l,color:m}=b,n=4*d,{textWidth:o,textHeight:p,rectWidth:q,rectHeight:r,rectData:s}=await a(c,g,n,h,k,l,e);j.postMessage({rectWidth:q,rectHeight:r,rectData:s});let{rectLeft:t,rectTop:u}=await f(j);i.push({text:c,rotation:e,fontFamily:g,fontSize:n,fontStyle:h,fontVariant:k,fontWeight:l,rectLeft:t,rectTop:u,rectWidth:q,rectHeight:r,textWidth:o,textHeight:p,color:m})}catch(a){}}}finally{j.terminate()}return await c.delayIfNotInterrupted(),i};return function(){let a;return async function(){let b=this,e=a={};return await c.call(this,{get interrupted(){return e!==a||b._isDestroyed},throwIfInterrupted(){if(this.interrupted)throw new d},async delayIfNotInterrupted(a){this.throwIfInterrupted(),await g(a),this.throwIfInterrupted()}})}}}(),scaledBoundedWords(){let a=this.boundedWords,b=this.containerWidth,d=this.containerHeight,e=this.maxFontSize,f=i(a,({rectLeft:a})=>a),g=j(a,({rectLeft:a,rectWidth:b})=>a+b),h=i(a,({rectTop:a})=>a),k=j(a,({rectTop:a,rectHeight:b})=>a+b),l=c(b/(g-f),d/(k-h)),m=j(a,({fontSize:a})=>a)*l;return m>e&&(l*=e/m),a.map(({text:a,color:c,fontFamily:e,fontSize:i,fontStyle:j,fontVariant:m,fontWeight:n,rotation:o,rectLeft:p,rectTop:q,rectWidth:r,rectHeight:s,textWidth:t,textHeight:u})=>(p=(p-(f+g)/2)*l+b/2,q=(q-(h+k)/2)*l+d/2,r*=l,s*=l,t*=l,u*=l,i*=l,{text:a,color:c,fontFamily:e,fontSize:i,fontStyle:j,fontVariant:m,fontWeight:n,rotation:o,rectLeft:p,rectTop:q,rectWidth:r,rectHeight:s,textWidth:t,textHeight:u}))},domWords(){let a=[...this.scaledBoundedWords],b=a.length,c=this.animationDuration/4,d=(this.animationDuration-c)/b,e=this.animationEasing,f={};return a.forEach(({text:a,color:b,fontFamily:g,fontSize:h,fontStyle:i,fontVariant:j,fontWeight:k,rotation:l,rectLeft:m,rectTop:n,rectWidth:o,rectHeight:p,textWidth:q,textHeight:r},s)=>{var t=Math.round;f[a]={style:{position:'absolute',left:`${m+o/2-q/2}px`,top:`${n+p/2}px`,color:b,font:[i,j,k,`${h}px/0`,g].join(' '),transform:`rotate(${l}turn)`,whiteSpace:'nowrap',transition:['all',`${t(c)}ms`,e,`${t(d*s)}ms`].join(' ')},text:a}}),f},startContainerSizeUpdate(){return function(){this._isDestroyed||(setTimeout(()=>{this.startContainerSizeUpdate()},this.containerSizeUpdateInterval),this.updateContainerSize())}}},watch:{},methods:{domRenderer(a){return a('div',{style:{position:'relative',width:'100%',height:'100%',overflow:'hidden'}},Object.entries(this.domWords).map(([b,{style:c,text:d}])=>a('div',{key:b,style:c},d)))},canvasRenderer(){},svgRenderer(){},updateContainerSize(){let{width:a,height:b}=this.$el.getBoundingClientRect();this.containerWidth=a,this.containerHeight=b}}};return a.component('VueWordCloud',m),m});
