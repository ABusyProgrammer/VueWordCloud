(function(a){'undefined'!=typeof module&&'undefined'!=typeof exports&&this===exports?module.exports=a(require('vue')):this.Vue.component('VueWordCloud',a(this.Vue))}).call(this,function(){var a=Math.round,b=Math.min,c=Math.floor;let d=class extends Error{constructor(...a){super(...a),this.name='CancelError'}},e=function(a,b){return a+(b-a)*Math.random()},f=function(a){let b=new Blob([a]),c=URL.createObjectURL(b);return new Worker(c)},g=function(a){return new Promise(function(b,c){let d,e=function(a){d(a),b(a.data)},f=function(a){d(a),c(a)};d=function(b){b.preventDefault(),a.removeEventListener('message',e),a.removeEventListener('error',f)},a.addEventListener('message',e),a.addEventListener('error',f)})},h=function(a=1){return new Promise((b)=>setTimeout(b,a))},i=function(a){return'function'==typeof a},j=function(a,b){let c=new Set;return a.filter((a)=>(a=b(a),!c.has(a))&&(c.add(a),!0))},k=function(a,c){let d=Infinity;for(let e of a)d=b(c(e),d);return d},l=function(a,b){let c=-Infinity;for(let d of a)c=Math.max(b(d),c);return c},m=function(a){return 2*a*Math.PI},n=function(a,b,c,d=1){const e=a,f=d,g=c,[h,i]=b;if(h===i)return h;if(f===g)return e<=f?h:i;let j=e;return j=(j-f)/(g-f),j=j*(i-h)+h,j},o={renderer(){return this.domRenderer},normalizedWords(){let a=this.words.map((a)=>{let b,c,d,e,f,g,h,i;if(a)switch(typeof a){case'string':{b=a;break}case'object':{Array.isArray(a)?[b,c]=a:({text:b,weight:c,rotation:d,fontFamily:e,fontStyle:f,fontVariant:g,fontWeight:h,color:i}=a);break}}return void 0===b&&('function'==typeof this.text?b=this.text(a):b=this.text),void 0===c&&('function'==typeof this.weight?c=this.weight(a):c=this.weight),void 0===d&&('function'==typeof this.rotation?d=this.rotation(a):d=this.rotation),void 0===e&&('function'==typeof this.fontFamily?e=this.fontFamily(a):e=this.fontFamily),void 0===f&&('function'==typeof this.fontStyle?f=this.fontStyle(a):f=this.fontStyle),void 0===g&&('function'==typeof this.fontVariant?g=this.fontVariant(a):g=this.fontVariant),void 0===h&&('function'==typeof this.fontWeight?h=this.fontWeight(a):h=this.fontWeight),void 0===i&&('function'==typeof this.color?i=this.color(a):i=this.color),{text:b,weight:c,rotation:d,fontFamily:e,fontStyle:f,fontVariant:g,fontWeight:h,color:i}});a=a.filter(({text:a})=>a),a=a.filter(({weight:a})=>0<a),a=j(a,({text:a})=>a),a.sort((a,b)=>b.weight-a.weight);let b=k(a,({weight:a})=>a),c=l(a,({weight:a})=>a);if(this.fontSizeRatio)for(let d of a)d.weight=n(d.weight,[1,this.fontSizeRatio],c,b);else for(let c of a)c.weight/=b;return a}},p=function(){let a=async function(a,b,c,d,e,f,g){var h=Math.ceil,i=Math.sin,j=Math.abs,k=Math.cos;g=m(g);let l=[d,e,f,`${c}px`,b].join(' ');try{await document.fonts.load(l,a)}catch(a){}let n=document.createElement('canvas').getContext('2d');n.font=l;let o=n.measureText(a).width,p=c,q=h(o*j(k(g))+p*j(i(g))),r=h(o*j(i(g))+p*j(k(g))),s=new Uint8Array(q*r);if(0<s.length){let b=document.createElement('canvas').getContext('2d');b.canvas.width=q,b.canvas.height=r,b.translate(q/2,r/2),b.rotate(g),b.font=l,b.textAlign='center',b.textBaseline='middle',b.fillText(a,0,0);let c=b.getImageData(0,0,q,r).data;for(let a=0,b=s.length;a<b;++a)s[a]=c[4*a+3]}return{textWidth:o,textHeight:p,rectWidth:q,rectHeight:r,rectData:s}},d=async function(b,d,e,h){let i=[],j=f("let RectCenterOutIterator=function*(a,b){var c=Math.ceil,d=Math.floor;if(0<a&&0<b){let e,f;a>b?(e=1,f=b/a):b>a?(f=1,e=a/b):e=f=1;let g=d(a/2),h=d(b/2),i=a-g,j=b-h;if(g<i)for(let a=g;a<=i;++a)yield[a,h];else if(h<j)for(let a=h;a<=j;++a)yield[g,a];for(let k=g,l=h,m=i,n=j;i<a||j<b;){g-=e,h-=f,i+=e,j+=f;let a=d(g),b=d(h),o=c(i),p=c(j);if(o>m)for(let a=b;a<p;++a)yield[o,a];if(p>n)for(let b=o;b>a;--b)yield[b,p];if(a<k)for(let c=p;c>b;--c)yield[a,c];if(b<l)for(let c=a;c<o;++c)yield[c,b];k=a,l=b,m=o,n=p}}},AsyncQueue=class{constructor(){this._values=[]}enqueue(a){this._values.push(a),this._promise&&this._resolvePromise()}async dequeue(){for(;;){if(this._values.length)return this._values.shift();this._promise||(this._promise=new Promise((a)=>{this._resolvePromise=a})),await this._promise,this._promise=void 0}}};(async function(){let a=new AsyncQueue;this.addEventListener('message',function({data:b}){a.enqueue(b)});let{gridWidth:b,gridHeight:c}=await a.dequeue(),d=new Uint8Array(b*c);for(;;){let{rectWidth:e,rectHeight:f,rectData:g}=await a.dequeue(),h=[];for(let a=0;a<e;++a)for(let b=0;b<f;++b)g[e*b+a]&&h.push([a,b]);this.postMessage((()=>{for(let[a,g]of RectCenterOutIterator(b-e,c-f))if((()=>{let c=[];for(let[e,f]of h){if(e+=a,f+=g,d[b*f+e])return!1;c.push([e,f])}for(let[a,e]of c)d[b*e+a]=1;return!0})())return{rectLeft:a,rectTop:g};throw new Error})())}}).call(self);");try{let f=4194304,k=c(Math.sqrt(d/e*f)),l=c(f/k);j.postMessage({gridWidth:k,gridHeight:l});for(let c of h){b.throwIfCanceled();try{let{text:b,weight:d,rotation:e,fontFamily:f,fontStyle:h,fontVariant:k,fontWeight:l,color:m}=c,n=4*d,{textWidth:o,textHeight:p,rectWidth:q,rectHeight:r,rectData:s}=await a(b,f,n,h,k,l,e);j.postMessage({rectWidth:q,rectHeight:r,rectData:s});let{rectLeft:t,rectTop:u}=await g(j);i.push({text:b,rotation:e,fontFamily:f,fontSize:n,fontStyle:h,fontVariant:k,fontWeight:l,rectLeft:t,rectTop:u,rectWidth:q,rectHeight:r,textWidth:o,textHeight:p,color:m})}catch(a){}}}finally{j.terminate()}return i},e=function(a,c,d,e){let f=k(a,({rectLeft:a})=>a),g=l(a,({rectLeft:a,rectWidth:b})=>a+b),h=k(a,({rectTop:a})=>a),i=l(a,({rectTop:a,rectHeight:b})=>a+b),j=b(c/(g-f),d/(i-h)),m=l(a,({fontSize:a})=>a)*j;m>e&&(j*=e/m);for(let b of a)b.rectLeft=(b.rectLeft-(f+g)/2)*j+c/2,b.rectTop=(b.rectTop-(h+i)/2)*j+d/2,b.rectWidth*=j,b.rectHeight*=j,b.textWidth*=j,b.textHeight*=j,b.fontSize*=j};return async function(a){let b=this.containerWidth,c=this.containerHeight;if(0>=b||0>=c)return[];let f=this.maxFontSize,g=this.normalizedWords;await a.delayIfNotCanceled();let h=await d(a,b,c,g);return await a.delayIfNotCanceled(),e(h,b,c,f),await a.delayIfNotCanceled(),h}}(),q={boundedWords:{get:p,default:function(){return[]}}},r={},s={updateContainerSize:{method(){if(this.mounted&&this.$el){let{width:a,height:b}=this.$el.getBoundingClientRect();this.containerWidth=a,this.containerHeight=b}},interval(){return this.containerSizeUpdateInterval}}},t={domRenderer(b){let c=[...this.boundedWords],d=c.length,e=this.animationDuration/2,f=this.animationEasing;return b('div',{style:{position:'relative',width:'100%',height:'100%',overflow:'hidden'}},c.map(({text:c,color:g,fontFamily:h,fontSize:i,fontStyle:j,fontVariant:k,fontWeight:l,rotation:m,rectLeft:n,rectTop:o,rectWidth:p,rectHeight:q,textWidth:r,textHeight:s},t)=>b('div',{key:c,style:{position:'absolute',left:`${n+p/2-r/2}px`,top:`${o+q/2}px`,color:g,font:[j,k,l,`${i}px/0`,h].join(' '),transform:`rotate(${m}turn)`,whiteSpace:'nowrap',transition:['all',`${a(e)}ms`,f,`${a(e/d*t)}ms`].join(' ')}},c)))},canvasRenderer(){let a=document.createElement('canvas'),b=a.getContext('2d');return this.boundedWords.forEach(({text:a,color:c,fontFamily:d,fontSize:e,fontStyle:f,fontVariant:g,fontWeight:h,rotation:i,rectLeft:j,rectTop:k,rectWidth:l,rectHeight:n,textWidth:o,textHeight:p})=>{b.save(),b.font=[f,g,h,`${e}px`,d].join(' '),b.fillStyle=c,b.textAlign='center',b.textBaseline='middle',b.fillText(a,0,0),b.translate(j+l/2,k+n/2),b.rotate(m(i)),b.restore()}),a},svgRenderer(){}};return function(){let a=class{constructor(){this.canceled=!1}cancel(){this.canceled=!0}throwIfCanceled(){if(this.canceled)throw new d}async delayIfNotCanceled(a){this.throwIfCanceled(),await h(a),this.throwIfCanceled()}};Object.entries(q).forEach(([b,c])=>{let d='duqugwtjleyi$'+b,e='xvvzxtpxrfjr$'+b;Object.assign(o,{[d](){return this[e]()},[e](){let b;return async function(...d){b&&b.cancel();let e=b=new a,f=await c.get.call(this,e,...d);return e.throwIfCanceled(),f}}}),Object.assign(r,{[d]:{async handler(a){try{this[b]=await a}catch(a){}},immediate:!0}})})}(),function(){Object.entries(s).forEach(([a,b])=>{let c='wkoojrkxgnng$'+a,d='ozyvltnleyhp$'+a;Object.assign(t,{[a]:b.method}),Object.assign(o,{[c](){return this[d]()},[d](){let c;return function(){clearTimeout(c);let d=()=>{this.destroyed||(c=setTimeout(d,i(b.interval)?b.interval.call(this):b.interval),this[a]())};d()}}}),Object.assign(r,{[c]:{handler(){},immediate:!0}})})}(),{render(a){return this.renderer(a)},props:{words:{type:Array,default(){return[]}},text:{type:[String,Function],default:''},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default(){let a=[0,0.75];return function(){return a[c(Math.random()*a.length)]}}},fontFamily:{type:[String,Function],default:'serif'},fontStyle:{type:[String,Function],default:'normal'},fontVariant:{type:[String,Function],default:'normal'},fontWeight:{type:[String,Function],default:'normal'},color:{type:[String,Function],default:'Black'},fontSizeRatio:{type:Number},maxFontSize:{type:Number,default:Infinity},animationDuration:{type:Number,default:5e3},animationEasing:{type:String,default:'ease'},containerSizeUpdateInterval:{type:Number,default:1e3}},data(){let a={mounted:!1,destroyed:!1,animatedBoundedWords:[],containerWidth:0,containerHeight:0};return Object.entries(q).forEach(([b,c])=>{a[b]=i(c.default)?c.default.call(this):c.default}),a},mounted(){this.mounted=!0},beforeDestroy(){this.destroyed=!0},computed:o,watch:r,methods:t}});