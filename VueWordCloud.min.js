(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b(require('vue')):'function'==typeof define&&define.amd?define(['vue'],b):a.VueWordCloud=b(a.Vue)})(this,function(a){'use strict';var b=Math.min,c=Math.max,d=Math.floor,e=Math.ceil;a=a&&a.hasOwnProperty('default')?a['default']:a;var f=class extends Error{constructor(...a){super(...a),this.name='InterruptError'}},g=function(a=1){return new Promise((b)=>setTimeout(b,a))},h=function(a){return new Promise(function(b,c){let d,e=function(a){d(a),b(a.data)},f=function(a){d(a),c(a)};d=function(b){b.preventDefault(),a.removeEventListener('message',e),a.removeEventListener('error',f)},a.addEventListener('message',e),a.addEventListener('error',f)})},i=function(a){return a[0]},j=function(a){return a[a.length-1]},k=function(a,b){return a.slice().sort((a,c)=>(a=b(a),c=b(c),a<c?-1:a>c?1:0))},l=function(a,b){let c=a.length;for(;0<c--&&!b(a[c],c););return a.slice(0,c+1)},m=function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},n=function(a){return 2*a*Math.PI},o=function(a){return Math.pow(2,e(Math.log(a)/Math.LN2))},p=function(a,b,c){var d=Math.sin,f=Math.abs,g=Math.cos;return[e(a*f(g(c))+b*f(d(c))),e(a*f(d(c))+b*f(g(c)))]},q=URL.createObjectURL(new Blob(['(function(){\'use strict\';var a=function*(a,b){var c=Math.ceil,d=Math.floor;if(0<a&&0<b){let e,f;a>b?(e=1,f=b/a):b>a?(f=1,e=a/b):e=f=1;let g=d(a/2),h=d(b/2),i=a-g,j=b-h;if(g<i)for(let a=g;a<=i;++a)yield[a,h];else if(h<j)for(let a=h;a<=j;++a)yield[g,a];for(let k=g,l=h,m=i,n=j;i<a||j<b;){g-=e,h-=f,i+=e,j+=f;let a=d(g),b=d(h),o=c(i),p=c(j);if(o>m)for(let a=b;a<p;++a)yield[o,a];if(p>n)for(let b=o;b>a;--b)yield[b,p];if(a<k)for(let c=p;c>b;--c)yield[a,c];if(b<l)for(let c=a;c<o;++c)yield[c,b];k=a,l=b,m=o,n=p}}},b=class{constructor(){this._values=[]}enqueue(a){this._values.push(a),this._promise&&this._resolvePromise()}async dequeue(){for(;;){if(this._values.length)return this._values.shift();this._promise||(this._promise=new Promise((a)=>{this._resolvePromise=a})),await this._promise,this._promise=void 0}}};(async function(){let c=new b;this.addEventListener(\'message\',function({data:a}){c.enqueue(a)});let{gridWidth:d,gridHeight:e}=await c.dequeue(),f=new Uint8Array(d*e);for(;;){let{rectWidth:b,rectHeight:g,rectData:h}=await c.dequeue(),i=[];for(let a=0;a<b;++a)for(let c=0;c<g;++c)h[b*c+a]&&i.push([a,c]);this.postMessage((()=>{for(let[c,h]of a(d-b,e-g))if((()=>{for(let[a,b]of i)if(a+=c,b+=h,f[d*b+a])return!1;for(let[a,b]of i)a+=c,b+=h,f[d*b+a]=1;return!0})())return{rectLeft:c,rectTop:h};throw new Error})())}}).call(self)})();\n'])),r=async function(a){let b=this.containerWidth,e=this.containerHeight,f=this.normalizedWords,g=this.fontSizeRatio,r=[];if(0<f.length&&0<b&&0<e){await a.delayIfNotInterrupted();f=k(f,({weight:a})=>-a);let s,t=j(f).weight,u=i(f).weight;t<u&&0<g&&g<Infinity?(1>g&&(g=1/g),s=function(a){return m(a,t,u,1,g)}):(f=l(f,({weight:a})=>0<a),0<f.length&&(t=j(f).weight),s=function(a){return a/t});let v=new Worker(q);try{let g=4194304,i=d(Math.sqrt(b/e*g)),j=d(g/i);i=o(i),j=o(j),v.postMessage({gridWidth:i,gridHeight:j});for(let b of f){a.throwIfInterrupted();try{let{key:a,text:d,weight:e,rotation:f,fontFamily:g,fontStyle:i,fontVariant:j,fontWeight:k,color:l}=b,m=4*s(e),q=n(f),t=[i,j,k,`${m}px`,g].join(' ');try{await document.fonts.load(t,d)}catch(a){}let u=document.createElement('canvas').getContext('2d');u.font=t;let w=u.measureText(d).width;if(0<w){let b=m,n=c(u.measureText('m').width,m),[s,x]=p(w,b,q),[y,z]=p(w+2*n,b+2*n,q);y=o(y),z=o(z);let A=new Uint8Array(y*z);u.canvas.width=y,u.canvas.height=z,u.translate(y/2,z/2),u.rotate(q),u.font=t,u.textAlign='center',u.textBaseline='middle',u.fillText(d,0,0);let B=u.getImageData(0,0,y,z).data;for(let a=0,b=A.length;a<b;++a)A[a]=B[4*a+3];v.postMessage({rectWidth:y,rectHeight:z,rectData:A});let{rectLeft:C,rectTop:D}=await h(v),E=C+(y-s)/2,F=D+(z-x)/2;r.push({key:a,text:d,weight:e,rotation:f,fontFamily:g,fontSize:m,fontStyle:i,fontVariant:j,fontWeight:k,rectLeft:E,rectTop:F,rectWidth:s,rectHeight:x,textWidth:w,textHeight:b,color:l})}}catch(a){}}}finally{v.terminate()}await a.delayIfNotInterrupted()}return r},s=function(a,c){let d=Infinity;for(let e of a)d=b(c(e),d);return d},t=function(a,b){let d=-Infinity;for(let e of a)d=c(b(e),d);return d};let u=function({text:a}){return a},v={name:'VueWordCloud',render(a){return this.renderer(a)},props:{words:{type:Array,default(){return[]}},text:{type:[String,Function],default:''},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default(){let a=[0,0.75];return function(){return a[d(Math.random()*a.length)]}}},fontFamily:{type:[String,Function],default:'serif'},fontStyle:{type:[String,Function],default:'normal'},fontVariant:{type:[String,Function],default:'normal'},fontWeight:{type:[String,Function],default:'normal'},color:{type:[String,Function],default:'Black'},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:Infinity},containerSizeUpdateInterval:{type:Number,default:1e3}},data(){return{containerWidth:0,containerHeight:0,fulfilledBoundedWords:[]}},mounted(){this.updateContainerSizeTrigger()},computed:{renderer(){return this.domRenderer},normalizedWords:function(){let a=function(){let a={};return function(b){let c=JSON.stringify(b),d=a[c]||0;return a[c]=d+1,0<d&&(c+=`-${d}`),c}}();return this.words.map((b)=>{let c,d,e,f,g,h,i,j;if(b)switch(typeof b){case'string':{c=b;break}case'object':{Array.isArray(b)?[c,d]=b:({text:c,weight:d,rotation:e,fontFamily:f,fontStyle:g,fontVariant:h,fontWeight:i,color:j}=b);break}}void 0===c&&('function'==typeof this.text?c=this.text(b):c=this.text),void 0===d&&('function'==typeof this.weight?d=this.weight(b):d=this.weight),void 0===e&&('function'==typeof this.rotation?e=this.rotation(b):e=this.rotation),void 0===f&&('function'==typeof this.fontFamily?f=this.fontFamily(b):f=this.fontFamily),void 0===g&&('function'==typeof this.fontStyle?g=this.fontStyle(b):g=this.fontStyle),void 0===h&&('function'==typeof this.fontVariant?h=this.fontVariant(b):h=this.fontVariant),void 0===i&&('function'==typeof this.fontWeight?i=this.fontWeight(b):i=this.fontWeight),void 0===j&&('function'==typeof this.color?j=this.color(b):j=this.color);let k=a([c,f,g,h,i]);return{key:k,text:c,weight:d,rotation:e,fontFamily:f,fontStyle:g,fontVariant:h,fontWeight:i,color:j}})},boundedWords(){return(async()=>{try{this.fulfilledBoundedWords=await this.promisedBoundedWords}catch(a){}})(),this.fulfilledBoundedWords},promisedBoundedWords(){return this.computeBoundedWords()},computeBoundedWords(){let a;return async function(){let b=this,c=a={};return await r.call(this,{get interrupted(){return c!==a||b._isDestroyed},throwIfInterrupted(){if(this.interrupted)throw new f},async delayIfNotInterrupted(a){this.throwIfInterrupted(),await g(a),this.throwIfInterrupted()}})}},scaledBoundedWords:function(){let a=this.boundedWords,c=this.containerWidth,d=this.containerHeight,e=this.maxFontSize,f=s(a,({rectLeft:a})=>a),g=t(a,({rectLeft:a,rectWidth:b})=>a+b),h=s(a,({rectTop:a})=>a),i=t(a,({rectTop:a,rectHeight:b})=>a+b),j=b(c/(g-f),d/(i-h)),k=t(a,({fontSize:a})=>a)*j;return k>e&&(j*=e/k),a.map(({key:a,text:b,weight:e,color:k,fontFamily:l,fontSize:m,fontStyle:n,fontVariant:o,fontWeight:p,rotation:q,rectLeft:r,rectTop:s,rectWidth:t,rectHeight:u,textWidth:v,textHeight:w})=>(r=(r-(f+g)/2)*j+c/2,s=(s-(h+i)/2)*j+d/2,t*=j,u*=j,v*=j,w*=j,m*=j,{key:a,text:b,weight:e,color:k,fontFamily:l,fontSize:m,fontStyle:n,fontVariant:o,fontWeight:p,rotation:q,rectLeft:r,rectTop:s,rectWidth:t,rectHeight:u,textWidth:v,textHeight:w}))},domWords(){},createWordElement(){return this.$scopedSlots.default?this.$scopedSlots.default:u},updateContainerSizeTrigger(){return function(){this._isDestroyed||(setTimeout(()=>{requestAnimationFrame(()=>{this.updateContainerSizeTrigger()})},this.containerSizeUpdateInterval),this.updateContainerSize())}}},methods:{domRenderer(a){let b=[...this.scaledBoundedWords],c=this.createWordElement;return a('div',{style:{position:'relative',width:'100%',height:'100%',overflow:'hidden'}},b.map(({key:b,text:d,weight:e,color:f,fontFamily:g,fontSize:h,fontStyle:i,fontVariant:j,fontWeight:k,rotation:l,rectLeft:m,rectTop:n,rectWidth:o,rectHeight:p,textWidth:q,textHeight:r})=>a('div',{key:b,style:{position:'absolute',left:`${m+o/2}px`,top:`${n+p/2}px`,transform:`rotate(${l}turn)`}},[a('div',{style:{position:'absolute',left:'50%',top:'50%',width:`${q}px`,height:`${r}px`,color:f,font:[i,j,k,`${h}px/1`,g].join(' '),whiteSpace:'nowrap',transform:'translate(-50%, -50%)'}},c({text:d,weight:e,color:f,fontFamily:g,fontSize:h,fontStyle:i,fontVariant:j,fontWeight:k,rotation:l}))])))},canvasRenderer(){},svgRenderer(){},updateContainerSize(){let{width:a,height:b}=this.$el.getBoundingClientRect();this.containerWidth=a,this.containerHeight=b}}};return a.component(v.name,v),v});
