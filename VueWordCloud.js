!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";var t=function(t){return function(){return t}},e=function(t){return"function"==typeof t},n=function(){return[]},r=function(t){return t&&"object"==typeof t},i=function(){this.interrupted=!1,this.interruptHandlers=new Set};i.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},i.prototype.interrupt=function(){this.interrupted||(this.interrupted=!1,this.interruptHandlers.forEach(function(t){t()}))},i.prototype.onInterrupt=function(t){this.interrupted&&(this.interruptHandlers.has(t)||t()),this.interruptHandlers.add(t)};var o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},f=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})},u=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})},c=function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},h=function(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]},s=function(t){return 2*t*Math.PI},d=URL.createObjectURL(new Blob(['!function(){"use strict";var r=function(r,a){for(var t=0,n=r.length;t<n;++t)r[t]=a;return r},a=function(r,a,t,n,f,e){var o=function(r,a,t){for(var n=[],f=0;f<a;++f)for(var e=0;e<t;++e)r[a*e+f]&&n.push([f,e]);return n}(n,f,e);return function(r,a,t){if(r>0&&a>0){var n,f;r>a?(n=1,f=a/r):a>r?(f=1,n=r/a):n=f=1;var e=Math.floor(r/2),o=Math.floor(a/2),i=r-e,v=a-o;if(e<i)for(var u=e;u<=i;++u){var c=[u,o];if(t(c))return c}else if(o<v)for(var h=o;h<=v;++h){var s=[e,h];if(t(s))return s}for(var g=e,l=o,M=i,m=v;i<r||v<a;){e-=n,o-=f,i+=n,v+=f;var p=Math.floor(e),d=Math.floor(o),w=Math.ceil(i),y=Math.ceil(v);if(w>M)for(var A=d;A<y;++A){var k=[w,A];if(t(k))return k}if(y>m)for(var H=w;H>p;--H){var L=[H,y];if(t(L))return L}if(p<g)for(var W=y;W>d;--W){var b=[p,W];if(t(b))return b}if(d<l)for(var j=p;j<w;++j){var q=[j,d];if(t(q))return q}g=p,l=d,M=w,m=y}}}(a-f,t-e,function(t){for(var n=t[0],f=t[1],e=0,i=o.length;e<i;++e){var v=o[e],u=v[0],c=v[1];if(r[a*(c+f)+(u+n)])return!1}return!0})},t=function(a,t,n,f){for(var e=t/f,o=n/f,i=r(new Array(e*o),0),v=0;v<e;++v)for(var u=0;u<o;++u)r:for(var c=0;c<f;++c)for(var h=0;h<f;++h){var s=a[t*(u*f+h)+(v*f+c)];if(s){i[e*u+v]=s;break r}}return[i,e,o]},n=function(r,a,t,n,f,e,o,i){for(var v=0;v<o;++v)for(var u=0;u<i;++u){var c=e[o*u+v];if(c){r[a*(u+f)+(v+n)]=c}}};self.addEventListener("message",function(f){var e,o=f.data,i=o.words,v=o.containerAspect,u=o.aaaa;i=(i=function(r,a){return r.map(function(r){return[a(r),r]}).sort(function(r,a){var t=r[0],n=a[0];return t>n?1:t<n?-1:0}).map(function(r){return r[1]})}(i=i.map(function(r){var a=r.imageWidth,t=r.imageHeight,n=function(r){return Math.log(r)/Math.LN2}(Math.min(a,t)/Math.pow(u,2));return Object.assign({cccc:n},r)}),function(r){return-r.cccc})).map(function(f){for(var o=f.key,i=f.rectWidth,u=f.rectHeight,c=f.image,h=f.imageWidth,s=f.imageHeight,g=f.cccc,l=[[c,h,s]],M=1;M<g;++M){var m;c=(m=t(c,h,s,2))[0],h=m[1],s=m[2],l.push([c,h,s])}if(void 0===e){var p=Math.pow(2,16),d=Math.floor(Math.sqrt(v*p)),w=Math.floor(p/d),y=r(new Array(d*w),0);e=[[y,d,w]];for(var A=1;A<l.length;++A)d*=2,w*=2,y=r(new Array(d*w),0),e.unshift([y,d,w])}var k=e[l.length-1],H=k[0],L=k[1],W=k[2],b=a(H,L,W,c,h,s),j=b[0],q=b[1];n(H,L,0,j,q,c,h,s);for(var E=l.length-1;E-- >0;){j*=2,q*=2;var N;H=(N=e[E])[0],L=N[1],W=N[2];var O;c=(O=l[E])[0],h=O[1],s=O[2],n(H,L,0,j,q,c,h,s)}return{key:o,rectLeft:j+(h-i)/2,rectTop:q+(s-u)/2}}),self.postMessage(i)})}();\n'])),l=function(t,e,n,r,i){if(n>0&&r>0&&e.length>0){var o=n/r,l=function(t,e){var n={};if(t.length>0){var r=f(t,function(t){return t.weight}),i=u(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=c(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=c(a,r,i,1,o)})}}return n}(e,i);e=e.map(function(t){var e=t.key,n=t.text,r=t.rotation,i=t.fontFamily,o=t.fontStyle,f=t.fontVariant,u=t.fontWeight,c=Math.pow(3,2)*l[e]+1,d=function(t,e,n,r,i,o,a){a=s(a);var f=[e,n,r,i+"px",o].join(" "),u=document.createElement("canvas").getContext("2d");u.font=f;var c=u.measureText(t).width,d=i,l=h(c,d,a),v=l[0],g=l[1],p=Math.max(u.measureText("m").width,i),m=h(c+2*p,d+2*p,a);return[c,d,v,g,m[0],m[1]]}(n,o,f,u,c,i,r),v=d[0],g=d[1],p=d[2],m=d[3],y=d[4],w=d[5],W=a(y),M=a(w),b=function(t,e,n,r,i,o,a,f,u){u=s(u);var c=[e,n,r,i+"px",o].join(" "),h=document.createElement("canvas").getContext("2d");h.canvas.width=a,h.canvas.height=f,h.translate(a/2,f/2),h.rotate(u),h.font=c,h.shadowColor="#000000",h.shadowBlur=i/32,h.textAlign="center",h.textBaseline="middle",h.fillText(t,0,0);for(var d=function(t,e){for(var n=0,r=t.length;n<r;++n)t[n]=e;return t}(new Array(a*f),0),l=h.getImageData(0,0,a,f).data,v=0,g=d.length;v<g;++v)d[v]=l[4*v+3];return d}(n,o,f,u,c,i,W,M,r);return Object.assign({fontSize:c,textWidth:v,textHeight:g,rectWidth:p,rectHeight:m,image:b,imageWidth:W,imageHeight:M},t)});var v=new Worker(d);return t.onInterrupt(function(){v.terminate()}),v.postMessage({words:e.map(function(t){return{key:t.key,rectWidth:t.rectWidth,rectHeight:t.rectHeight,image:t.image,imageWidth:t.imageWidth,imageHeight:t.imageHeight}}),containerAspect:o,aaaa:4}),function(t){return new Promise(function(e,n){var r,i=function(t){r(t),e(t.data)},o=function(t){r(t),n(t)};r=function(e){e.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",o)},t.addEventListener("message",i),t.addEventListener("error",o)})}(v).then(function(t){var n={};return e.forEach(function(t){var e=t.key;n[e]=t}),t.forEach(function(t){var e=t.key;Object.assign(n[e],t)}),e}).finally(function(){v.terminate()})}return[]},v={boundedWords:{get:function(t){return l(t,this.populatedWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},default:n}},g={name:"VueWordCloud",props:{words:{type:Array,default:n},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){var t=this,n={containerWidth:0,containerHeight:0};return Object.entries(v).forEach(function(i){var o=i[0],a=i[1].default;e(a)&&(a=a.call(t)),r(a)&&(a=Object.freeze(a)),n["fulfilled$"+o]=a}),n},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,i,a,f,u,c,h){var s={};return t.forEach(function(t){var d,l,v,g,p,m,y,w,W;if(t)if(function(t){return"string"==typeof t}(t))l=t;else if(Array.isArray(t)){var M;l=(M=t)[0],v=M[1]}else if(r(t)){var b;d=(b=t).key,l=b.text,v=b.weight,g=b.rotation,p=b.fontFamily,m=b.fontStyle,y=b.fontVariant,w=b.fontWeight,W=b.color}for(void 0===l&&(l=e(t)),void 0===v&&(v=n(t)),void 0===g&&(g=i(t)),void 0===p&&(p=a(t)),void 0===m&&(m=f(t)),void 0===y&&(y=u(t)),void 0===w&&(w=c(t)),void 0===W&&(W=h(t)),void 0===d&&(d=JSON.stringify([l,p,m,y,w]));o(s,d);)d+="!";s[d]={originalWord:t,key:d,text:l,weight:v,rotation:g,fontFamily:p,fontStyle:m,fontVariant:y,fontWeight:w,color:W}}),s}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},populatedWords:function(){return Object.values(this.keyedPopulatedWords)},scaledBoundedWords:function(){return function(t,e,n,r){var i=f(t,function(t){return t.rectLeft}),o=u(t,function(t){return t.rectLeft+t.rectWidth}),a=o-i,c=f(t,function(t){return t.rectTop}),h=u(t,function(t){return t.rectTop+t.rectHeight}),s=h-c,d=Math.min(e/a,n/s),l=u(t,function(t){return t.fontSize})*d;return l>r&&(d*=r/l),t.map(function(t){var r=t.fontSize,a=t.textWidth,f=t.textHeight,u=t.rectLeft,s=t.rectTop,l=t.rectWidth,v=t.rectHeight;return r*=d,a*=d,f*=d,u=(u-(i+o)/2)*d+e/2,s=(s-(c+h)/2)*d+n/2,l*=d,v*=d,Object.assign({},t,{fontSize:r,textWidth:a,textHeight:f,rectLeft:u,rectTop:s,rectWidth:l,rectHeight:v})})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},beforeCreate:function(){var t=this;Object.entries(v).forEach(function(e){var n=e[0],o=e[1],a=o.errorHandler||function(){};t.$options.computed[n]=function(){var t=this;return Promise.resolve(this["promised$"+n]).then(function(e){r(e)&&(e=Object.freeze(e)),t["fulfilled$"+n]=e}).catch(a),this["fulfilled$"+n]};var f=new i;t.$options.computed["promised$"+n]=function(){var t=this;f.interrupt();var e=f=new i;return Promise.resolve(o.get.call(this,e)).then(function(n){if(t._isDestroyed)throw new Error;return e.throwIfInterrupted(),n})}})},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},n.map(function(n){var i=n.originalWord,o=n.key,a=n.text,f=n.weight,u=n.rotation,c=n.fontFamily,h=n.fontStyle,s=n.fontVariant,d=n.fontWeight,l=n.color,v=n.fontSize,g=(n.textWidth,n.textHeight,n.rectLeft),p=n.rectTop,m=n.rectWidth,y=n.rectHeight;return t("div",{key:o,style:{position:"absolute",top:p+y/2+"px",left:g+m/2+"px",transform:"rotate("+u+"turn)",color:l,transitionDuration:Math.round(r)+"ms",transitionProperty:"all",font:[h,s,d,v+"px/1",c].join(" ")}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[e.default({originalWord:i,text:a,weight:f,rotation:u,fontFamily:c,fontStyle:h,fontVariant:s,fontWeight:d,color:l,fontSize:v})])])}))}(t,Object.assign({default:function(t){return t.text}},this.$scopedSlots),this.scaledBoundedWords,this.animationDuration)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(g.name,g),g});
