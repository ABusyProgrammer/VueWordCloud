!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";function t(t){return function(){return t}}function e(t){return"function"==typeof t}function n(){}function r(){return[]}function i(t){return new Promise(function(e){e(t())})}var o=function(){this.interrupted=!1,this.interruptHandlers=new Set};o.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},o.prototype.interrupt=function(){this.interrupted||(this.interrupted=!1,this.interruptHandlers.forEach(function(t){t()}))},o.prototype.onInterrupt=function(t){this.interrupted&&(this.interruptHandlers.has(t)||t()),this.interruptHandlers.add(t)};function a(t,e,n){return i(function(){var r=new Worker(e),i=function(){r.terminate()};t.onInterrupt(i),r.postMessage(n);var o,a=(o=r,new Promise(function(t,e){var n,r=function(e){n(e),t(e.data)},i=function(t){n(t),e(t)};n=function(t){t.preventDefault(),o.removeEventListener("message",r),o.removeEventListener("error",i)},o.addEventListener("message",r),o.addEventListener("error",i)}));return a.then(i,i),a})}function u(t){return Math.pow(2,Math.ceil((e=t,Math.log(e)/Math.LN2)));var e}function f(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})}function h(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})}function c(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function s(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]}function d(t){return 2*t*Math.PI}function l(t,e,r,o,a,u,f){return i(function(){f=d(f);var h=[e,r,o,a+"px",u].join(" ");return(c=h,l=t,i(function(){return document.fonts.load(c,l)})).catch(n).then(function(){var e=document.createElement("canvas").getContext("2d");e.font=h;var n=e.measureText(t).width,r=a,i=s(n,r,f),o=i[0],u=i[1],c=Math.max(e.measureText("m").width,a),d=s(n+2*c,r+2*c,f);return[n,r,o,u,d[0],d[1]]});var c,l})}function v(t,e,n,r){return i(function(){var t=function(t,e){var n={};if(t.length>0){var r=f(t,function(t){return t.weight}),i=h(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=c(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=c(a,r,i,1,o)})}}return n}(e,r);return Promise.all(e.map(function(e){var r=e.key,i=e.text,o=e.rotation,a=e.fontFamily,f=e.fontStyle,h=e.fontVariant,c=e.fontWeight,s=Math.pow(n-1,2)*t[r]+1;return l(i,f,h,c,s,a,o).then(function(t){var r=t[0],l=t[1],v=t[2],g=t[3],p=t[4],m=t[5],y=Math.max(u(p),Math.pow(n,2)),w=Math.max(u(m),Math.pow(n,2)),W=function(t,e,n,r,i,o,a,u,f){f=d(f);var h=[e,n,r,i+"px",o].join(" "),c=document.createElement("canvas").getContext("2d");c.canvas.width=a,c.canvas.height=u,c.translate(a/2,u/2),c.rotate(f),c.font=h,c.textAlign="center",c.textBaseline="middle",c.fillText(t,0,0),c.miterLimit=1,c.lineWidth=3,c.strokeText(t,0,0);for(var s=new Uint8Array(a*u),l=c.getImageData(0,0,a,u).data,v=0,g=s.length;v<g;++v)s[v]=l[4*v+3];return s}(i,f,h,c,s,a,y,w,o);return Object.assign({fontSize:s,textWidth:r,textHeight:l,rectWidth:v,rectHeight:g,image:W,imageWidth:y,imageHeight:w},e)})}))})}var g={measuredWords:{get:function(t){return v(0,this.populatedWords,4,this.fontSizeRatio)},default:r}},p={boundedWords:{code:'!function(){"use strict";function r(r,t,a,o,n,e){var i=function(r,t,a){for(var o=[],n=0;n<t;++n)for(var e=0;e<a;++e)r[t*e+n]&&o.push([n,e]);return o}(o,n,e);return function(r,t,a){if(r>0&&t>0){var o,n;r>t?(o=1,n=t/r):t>r?(n=1,o=r/t):o=n=1;var e=Math.floor(r/2),i=Math.floor(t/2),f=r-e,v=t-i;if(e<f)for(var h=e;h<=f;++h){var u=[h,i];if(a(u))return u}else if(i<v)for(var l=i;l<=v;++l){var c=[e,l];if(a(c))return c}for(var g=e,M=i,s=f,d=v;f<r||v<t;){e-=o,i-=n,f+=o,v+=n;var m=Math.floor(e),p=Math.floor(i),W=Math.ceil(f),w=Math.ceil(v);if(W>s)for(var y=p;y<w;++y){var H=[W,y];if(a(H))return H}if(w>d)for(var x=W;x>m;--x){var S=[x,w];if(a(S))return S}if(m<g)for(var k=w;k>p;--k){var z=[m,k];if(a(z))return z}if(p<M)for(var L=m;L<W;++L){var A=[L,p];if(a(A))return A}g=m,M=p,s=W,d=w}}}(t-n,a-e,function(a){for(var o=a[0],n=a[1],e=0,f=i.length;e<f;++e){var v=i[e],h=v[0],u=v[1];if(r[t*(u+n)+(h+o)])return!1}return!0})}function t(r,t,a,o){for(var n=t/o,e=a/o,i=new Uint8Array(n*e),f=0;f<n;++f)for(var v=0;v<e;++v)r:for(var h=0;h<o;++h)for(var u=0;u<o;++u){var l=r[t*(v*o+u)+(f*o+h)];if(l){i[n*v+f]=l;break r}}return[i,n,e]}function a(r,t,a,o,n,e,i,f){for(var v=0;v<i;++v)for(var h=0;h<f;++h){var u=e[i*h+v];if(u){var l=v+o;if(l>=0&&l<t){var c=h+n;c>=0&&c<a&&(r[t*c+l]=u)}}}}var o=Math.pow(2,28),n=function(n,e,i,f){if(i>0&&f>0){var v=i/f,h=[],u=Math.floor(Math.sqrt(v*o)),l=Math.floor(o/u);return n=n.map(function(r){var t,a=r.imageWidth,o=r.imageHeight;return[(t=Math.min(a,o)/Math.pow(e,2),Math.log(t)/Math.LN2),r]}),c=function(r){return-r[0]},n=(n=n.map(function(r){return[c(r),r]}).sort(function(r,t){var a=r[0],o=t[0];return a>o?1:a<o?-1:0}).map(function(r){return r[1]})).map(function(o){for(var n=o[0],e=o[1],i=e.originalWord,f=e.key,v=e.text,c=e.weight,g=e.rotation,M=e.fontFamily,s=e.fontStyle,d=e.fontVariant,m=e.fontWeight,p=e.color,W=e.fontSize,w=e.textWidth,y=e.textHeight,H=e.rectWidth,x=e.rectHeight,S=e.image,k=e.imageWidth,z=e.imageHeight,L=[[S,k,z]],A=1;A<n;++A){var F;S=(F=t(S,k,z,2))[0],k=F[1],z=F[2],L.push([S,k,z])}if(h.length<1)for(var U=0;U<L.length;++U){var V=new Uint8Array(u*l);h.push(V)}var b=h[L.length-1],q=r(b,u,l,S,k,z),E=q[0],N=q[1];a(b,u,l,E,N,S,k,z);for(var P=L.length-1;P-- >0;){E=2*(E-u/4),N=2*(N-l/4),b=h[P];var T;S=(T=L[P])[0],k=T[1],z=T[2],a(b,u,l,Math.floor(E),Math.floor(N),S,k,z)}return{originalWord:i,key:f,text:v,weight:c,rotation:g,fontFamily:M,fontStyle:s,fontVariant:d,fontWeight:m,color:p,fontSize:W,textWidth:w,textHeight:y,rectLeft:Math.floor(E+(k-H)/2),rectTop:Math.floor(N+(z-x)/2),rectWidth:H,rectHeight:x}})}var c;return[]};self.addEventListener("message",function(r){var t=r.data,a=t.words,o=t.fontSizePower,e=t.containerWidth,i=t.containerHeight;self.postMessage(n(a,o,e,i))})}();\n',data:function(){return{words:this.measuredWords,fontSizePower:4,containerWidth:this.containerWidth,containerHeight:this.containerHeight}},default:r}};Object.entries(p).forEach(function(t){var e=t[0],n=t[1],r=n.code,i=n.data,o=n.default,u=n.errorHandler,f=URL.createObjectURL(new Blob([r]));g[e]={get:function(t){return a(t,f,i.call(this))},default:o,errorHandler:u}});var m={name:"VueWordCloud",props:{words:{type:Array,default:r},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[Number,Function],default:function(){var t=[0,.75];return function(){return(e=t)[Math.floor(e.length*Math.random())];var e}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){var t={containerWidth:0,containerHeight:0};return Object.keys(g).forEach(function(e){t["asyncComputed$trigger$"+e]={}}),t},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,r,i,o,a,u,f){var h={};return t.forEach(function(t){var c,s,d,l,v,g,p,m;if(t)if("string"==typeof t)c=t;else if(Array.isArray(t)){var y;c=(y=t)[0],s=y[1]}else if(W=t,W&&"object"==typeof W){var w;c=(w=t).text,s=w.weight,d=w.rotation,l=w.fontFamily,v=w.fontStyle,g=w.fontVariant,p=w.fontWeight,m=w.color}var W;void 0===c&&(c=e(t)),void 0===s&&(s=n(t)),void 0===d&&(d=r(t)),void 0===l&&(l=i(t)),void 0===v&&(v=o(t)),void 0===g&&(g=a(t)),void 0===p&&(p=u(t)),void 0===m&&(m=f(t));for(var M=JSON.stringify([c,l,v,g,p]);S=h,x=M,Object.prototype.hasOwnProperty.call(S,x);)M+="!";var S,x;h[M]={originalWord:t,key:M,text:c,weight:s,rotation:d,fontFamily:l,fontStyle:v,fontVariant:g,fontWeight:p,color:m}}),h}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},populatedWords:function(){return Object.values(this.keyedPopulatedWords)},scaledBoundedWords:function(){return function(t,e,n,r){var i=f(t,function(t){return t.rectLeft}),o=h(t,function(t){return t.rectLeft+t.rectWidth}),a=o-i,u=f(t,function(t){return t.rectTop}),c=h(t,function(t){return t.rectTop+t.rectHeight}),s=c-u,d=Math.min(e/a,n/s),l=h(t,function(t){return t.fontSize})*d;return l>r&&(d*=r/l),t.map(function(t){var e=t.fontSize,n=t.textWidth,r=t.textHeight,a=t.rectLeft,f=t.rectTop,h=t.rectWidth,s=t.rectHeight;return e*=d,n*=d,r*=d,a=(a-(i+o)/2)*d,f=(f-(u+c)/2)*d,h*=d,s*=d,Object.assign({},t,{fontSize:e,textWidth:n,textHeight:r,rectLeft:a,rectTop:f,rectWidth:h,rectHeight:s})})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},transitionDuration:function(){var t=this.scaledBoundedWords.length,e=this.animationDuration;return t>0?e/Math.min(4,t):0},transitionDelay:function(){var t=this.scaledBoundedWords.length,e=this.animationDuration,n=this.transitionDuration;return t>1?(e-n)/(t-1):0},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},beforeCreate:function(){var t=this;Object.entries(g).forEach(function(r){var a=r[0],u=r[1],f=u.get,h=u.default,c=u.errorHandler;void 0===c&&(c=n);var s;t.$options.computed[a]=function(){return this["asyncComputed$promise$"+a],this["asyncComputed$trigger$"+a],h},t.$options.computed["asyncComputed$promise$"+a]=function(){var t=this;s?s.interrupt():e(h)&&(h=h.call(this));var n=s=new o;return i(function(){return f.call(t,n)}).then(function(e){if(t._isDestroyed)throw new Error;n.throwIfInterrupted(),h=e,t["asyncComputed$trigger$"+a]={}}).catch(c)}})},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return e=t,n=Object.assign({default:function(t){return t.text}},this.$scopedSlots),r=this.scaledBoundedWords,i=this.transitionDuration,o=this.transitionDelay,e("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},[e("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.map(function(t,r){var a=t.originalWord,u=t.key,f=t.text,h=t.weight,c=t.rotation,s=t.fontFamily,d=t.fontStyle,l=t.fontVariant,v=t.fontWeight,g=t.color,p=t.fontSize,m=(t.textWidth,t.textHeight,t.rectLeft),y=t.rectTop,w=t.rectWidth,W=t.rectHeight;return e("div",{key:u,style:{position:"absolute",top:y+W/2+"px",left:m+w/2+"px",transform:"rotate("+c+"turn)",color:g,transition:["all",i+"ms","ease-in-out",o*r+"ms"].join(" "),font:[d,l,v,p+"px/1",s].join(" ")}},[e("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[n.default({originalWord:a,text:f,weight:h,rotation:c,fontFamily:s,fontStyle:d,fontVariant:l,fontWeight:v,color:g,fontSize:p})])])}))]);var e,n,r,i,o}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(m.name,m),m});
