!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.VueWordCloud=n()}(this,function(){"use strict";function t(t){return"function"==typeof t}function n(){}var i=function(t){this.previousValue=t,this.interrupted=!1,this.interruptHandlers=new Set};i.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},i.prototype.interrupt=function(){this.interrupted||(this.interrupted=!0,this.interruptHandlers.forEach(function(t){try{t()}catch(t){}}))},i.prototype.onInterrupt=function(t){if(this.interrupted&&!this.interruptHandlers.has(t))try{t()}catch(t){}this.interruptHandlers.add(t)};var r="asyncComputed_promise_",e="asyncComputed_trigger_";function o(){return[]}var u={words:{type:Array,default:o},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[Number,Function],default:0},rotationUnit:{type:[String,Function],default:"turn"},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function,Array],default:"Black"},spacing:{type:Number,default:0},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},renderingFontSizeInterval:{type:Number,default:2},renderingFontSizeBase:{type:Number,default:4},animationDuration:{type:Number,default:5e3},animationEasing:{type:String,default:"ease"},createCanvas:{type:Function,default:function(){return document.createElement("canvas")}},loadFont:{type:Function,default:function(t,n,i,r){return document.fonts.load([n,i,"1px",t].join(" "),r)}},createWorker:{type:Function,default:function(t){return new Worker(URL.createObjectURL(new Blob([t])))}}};function a(n){return t(n)?n:function(t){return function(){return t}}(n)}function f(t){return void 0===t}function s(t,n){return t.postMessage(n),function(t){return new Promise(function(n,i){var r,e=function(t){var i=t.data;r(),n(i)},o=function(t){var n=t.error;r(),i(n)};r=function(){t.removeEventListener("message",e),t.removeEventListener("error",o)},t.addEventListener("message",e),t.addEventListener("error",o)})}(t)}var c=function(t,n,i,r,e,o,u){this.t=t,this.n=n,this.i=i,this.r=r,this.e=e,this.o=o,this.u=u,this.a=1,this.f=0,this.s=0,this.c=0},h={h:{configurable:!0},l:{configurable:!0},d:{configurable:!0},v:{configurable:!0},m:{configurable:!0},p:{configurable:!0},g:{configurable:!0},y:{configurable:!0},b:{configurable:!0},M:{configurable:!0},w:{configurable:!0},F:{configurable:!0},S:{configurable:!0},x:{configurable:!0},W:{configurable:!0},j:{configurable:!0}};h.h.get=function(){return this.a},h.h.set=function(t){this.a!==t&&(this.a=t,this.P=void 0)},h.l.get=function(){return t=this.r,n=this.e,i=this.o,r=this.h,e=this.i,[t,n,i,r+"px",e].join(" ");var t,n,i,r,e},h.d.get=function(){var t,n,i,r;return void 0===this.k&&(this.k=(t=this.t,n=this.l,i=this.u,(r=i().getContext("2d")).font=n,r.measureText(t).width/this.h)),this.k},h.v.get=function(){return this.d*this.h},h.m.get=function(){return this.s*this.h},h.m.set=function(t){this.s=t/this.h},h.p.get=function(){return this.c*this.h},h.p.set=function(t){this.c=t/this.h},h.g.get=function(){return this.f},h.g.set=function(t){this.f!==t&&(this.f=t,this.P=void 0)},h.y.get=function(){return this.g*this.h},h.b.get=function(){var t,n,i;return void 0===this.P&&(this.P=function(t,n,i,r,e,o,u){var a=u(),f=a.getContext("2d");a.width=e,a.height=o,f.translate(e/2,o/2),f.rotate(r),f.font=n,f.textAlign="center",f.textBaseline="middle",f.fillText(t,0,0),i>0&&(f.miterLimit=1,f.lineWidth=i,f.strokeText(t,0,0));for(var s=f.getImageData(0,0,e,o).data,c=[],h=1/0,l=0,d=1/0,v=0,m=0;m<e;++m)for(var p=0;p<o;++p)s[4*(e*p+m)+3]&&(c.push([m,p]),h=Math.min(m,h),l=Math.max(m+1,l),d=Math.min(p,d),v=Math.max(p+1,v));return c.length<1?[c,0,0,0,0]:[c.map(function(t){var n=t[0],i=t[1];return[n-h,i-d]}),l-h,v-d,Math.ceil(e/2)-h,Math.ceil(o/2)-d]}(this.t,this.l,2*this.y,this.n,(t=this.v+2*(this.y+this.h),n=this.h+2*(this.y+this.h),i=this.n,Math.ceil(t*Math.abs(Math.cos(i))+n*Math.abs(Math.sin(i)))),function(t,n,i){return Math.ceil(t*Math.abs(Math.sin(i))+n*Math.abs(Math.cos(i)))}(this.v+2*(this.y+this.h),this.h+2*(this.y+this.h),this.n),this.u)),this.P},h.M.get=function(){return this.b[0]},h.w.get=function(){return this.b[1]},h.F.get=function(){return this.b[2]},h.S.get=function(){return this.b[3]},h.x.get=function(){return this.b[4]},h.W.get=function(){return Math.ceil(this.m)-this.S},h.W.set=function(t){this.m=t+this.S},h.j.get=function(){return Math.ceil(this.p)-this.x},h.j.set=function(t){this.p=t+this.x},Object.defineProperties(c.prototype,h);var l={cloudWords:function(t){this.$emit("update:cloudWords",t)},progress:{handler:function(t){this.$emit("update:progress",t)},deep:!0,immediate:!0}};var d={detectElementResize:function(){this.elementWidth=this.$el.offsetWidth,this.elementHeight=this.$el.offsetHeight},startElementResizeDetector:function(){var t=this;requestAnimationFrame(function(){t._isDestroyed||(setTimeout(function(){t.startElementResizeDetector()},1e3),t.detectElementResize())})}},v="div";var m={name:"VueWordCloud",mixins:[function(o){return{data:function(){var t={};return Object.keys(o).forEach(function(n){t[e+n]={}}),t},computed:{},beforeCreate:function(){var u=this,a=new Set;Object.entries(o).forEach(function(o){var f=o[0],s=o[1],c=s.get,h=s.default,l=s.errorHandler;void 0===l&&(l=n);var d,v=!0;u.$options.computed[f]=function(){return this[e+f],this[r+f],h},u.$options.computed[r+f]=function(){var n=this;d&&(d.interrupt(),a.delete(d)),v&&(v=!1,t(h)&&(h=h.call(this)));var r=new i(h);d=r,a.add(d),new Promise(function(t){t(c.call(n,r))}).then(function(t){r.throwIfInterrupted(),h=t,n[e+f]={}}).catch(l)}})}}}({cloudWords:{get:function(t){var i,r=this,e=this,o=e.elementWidth,u=e.elementHeight,h=e.words,l=e.text,d=e.weight,v=e.rotation,m=e.rotationUnit,p=e.fontFamily,g=e.fontStyle,y=e.fontVariant,b=e.fontWeight,M=e.color,w=e.spacing,F=e.fontSizeRatio,S=e.renderingFontSizeInterval,x=e.renderingFontSizeBase,W=e.createCanvas,j=e.loadFont,P=e.createWorker;i=F,F=(i=Math.abs(i))>1?1/i:i;var k=function(t){var n=t[0],i=t[1];return n>i?[1,i/n]:i>n?[n/i,1]:[1,1]}([o,u]);if(o>0&&u>0){var B=a(l),E=a(d),N=a(v),z=a(m),T=a(p),L=a(g),O=a(y),C=a(b),q=a(M);return h=h.map(function(t,n){var i,r,e,o,u,a,s,l,d,v,m;t&&("string"==typeof t?e=t:Array.isArray(t)?(e=(i=t)[0],o=i[1]):function(t){return t&&"object"==typeof t}(t)&&(e=(r=t).text,o=r.weight,u=r.rotation,a=r.rotationUnit,s=r.fontFamily,l=r.fontStyle,d=r.fontVariant,v=r.fontWeight,m=r.color)),f(e)&&(e=B(t,n,h)),f(o)&&(o=E(t,n,h)),f(u)&&(u=N(t,n,h)),f(a)&&(a=z(t,n,h)),f(s)&&(s=T(t,n,h)),f(l)&&(l=L(t,n,h)),f(d)&&(d=O(t,n,h)),f(v)&&(v=C(t,n,h)),f(m)&&(m=q(t,n,h));var p=new c(e,function(){switch(a){case"turn":return u*Math.PI*2;case"deg":return function(t){return t*Math.PI/180}(u)}return u}(),s,l,d,v,W);return Object.assign(p,{B:t,N:o,z:m}),p}),Promise.resolve().then(function(){return Promise.all(h.map(function(t){var n=t.i,i=t.r,r=t.o,e=t.t;return j(n,i,r,e)}))}).catch(n).then(function(){if((h=h.filter(function(t){return t.v>0}).sort(function(t,n){return n.N-t.N})).length>0){var n=h[0],i=function(t){return t[t.length-1]}(h),e=n.N,a=i.N;if(a<e){var f=F>0?1/F:a>0?e/a:e<0?a/e:1+e-a;h.forEach(function(t){var n,i,r;t.h=(n=t.N,(r=1)+(n-(i=a))*(f-r)/(e-i))})}h.reduceRight(function(t,n){return n.h<S*t?n.h/=t:(t=n.h,n.h=1),n.T=t},1),h.forEach(function(t){t.h*=x});var c=P('!function(){"use strict";var r=function(t){self.removeEventListener("message",r);var n,f,a,u,e,i=t.data,o=function(){n={},f=0,a=0,u=0,e=0};o();var v=function(){return Math.ceil((f+a)/2)},c=function(){return Math.ceil((u+e)/2)},s=function(){return{left:v(),top:c(),width:a-f,height:e-u}},h=function(r,t,f){return function(r,t,n){var f,a,u=r[0],e=r[1],i=t[0],o=t[1];u>e?(f=1,a=e/u):e>u?(a=1,f=u/e):f=a=1;var v=[i,o];if(n(v))return v;for(var c=i,s=o,h=i,M=o,l=c,g=s;;){i-=f,o-=a,c+=f,s+=a;var d=Math.floor(i),m=Math.floor(o),p=Math.ceil(c),w=Math.ceil(s);if(p>l)for(var B=m;B<w;++B){var F=[p,B];if(n(F))return F}if(w>g)for(var b=p;b>d;--b){var j=[b,w];if(n(j))return j}if(d<h)for(var k=w;k>m;--k){var q=[d,k];if(n(q))return q}if(m<M)for(var x=d;x<p;++x){var y=[x,m];if(n(y))return y}h=d,M=m,l=p,g=w}}(i,[t+v(),f+c()],function(t){var f=t[0],a=t[1];return function(r,t,f){return r.every(function(r){var a=r[0],u=r[1];return!n[t+a+"|"+(f+u)]})}(r,f,a)})};self.postMessage({}),self.addEventListener("message",function(r){self.postMessage({getBounds:s,put:function(r,t,i){r.forEach(function(r){var o=r[0],v=r[1],c=t+o,s=i+v;n[c+"|"+s]=!0,f=Math.min(c,f),a=Math.max(c+1,a),u=Math.min(s,u),e=Math.max(s+1,e)})},findFit:h,clear:o}[r.data.name].apply(null,r.data.args))})};self.addEventListener("message",r)}();\n'),l={completedWords:0,totalWords:h.length};return Promise.resolve().then(function(){return t.throwIfInterrupted(),r.progress=l,s(c,k)}).then(function(){t.throwIfInterrupted(),l.completedWords++;var n=Promise.resolve();return h.reduce(function(i,r,e){return n=n.then(function(){return r.T<i.T?Promise.resolve().then(function(){return s(c,{name:"clear"})}).then(function(){var t=Promise.resolve(),n=i.T/r.T;return h.slice(0,e).forEach(function(i){t=t.then(function(){return i.h*=n,s(c,{name:"put",args:[i.M,i.W,i.j]})})}),t}):s(c,{name:"put",args:[i.M,i.W,i.j]})}).then(function(){return r.g=w,s(c,{name:"findFit",args:[r.M,r.W,r.j]})}).then(function(n){var i=n[0],e=n[1];t.throwIfInterrupted(),l.completedWords++,r.W=i,r.j=e,r.g=0}),r}),n}).then(function(){return s(c,{name:"put",args:[i.M,i.W,i.j]})}).then(function(){return s(c,{name:"getBounds"})}).then(function(t){var n=t.left,i=t.top,r=t.width,e=t.height;if(r>0&&e>0){var a=Math.min(o/r,u/e);h.forEach(function(t){t.m-=n,t.p-=i,t.h*=a})}var f=new Set;return h.map(function(t){for(var n=t.B,i=t.t,r=t.N,e=t.n,o=t.l,u=t.m,a=t.p,s=t.z,c=JSON.stringify([i,p,g,y,b]);f.has(c);)c+="!";return f.add(c),{key:c,word:n,text:i,weight:r,rotation:e,font:o,color:s,left:u,top:a}})}).finally(function(){c.terminate()}).finally(function(){t.throwIfInterrupted(),r.progress=null})}return[]})}return[]},default:o}})],props:u,data:function(){return{elementWidth:0,elementHeight:0,progress:null}},watch:l,mounted:function(){this.startElementResizeDetector()},methods:d,render:function(t){var n=this.cloudWords,i=this.animationDuration,r=this.animationEasing,e=Object.assign({},{default:function(t){return t.text}},this.$scopedSlots),o=n.length>0?i/Math.min(4,n.length):0,u=n.length>1?(i-o)/(n.length-1):0;return t(v,{style:{position:"relative",width:"100%",height:"100%"}},[t(v,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},n.map(function(n,a){var f=n.word,s=n.key,c=n.text,h=n.weight,l=n.rotation,d=n.font,m=n.color,p=n.left,g=n.top;return t("transition",{props:{css:!1},on:{beforeEnter:function(t){t.style.opacity=0,t.style.transform="rotate("+l+"rad) scale3d(0.3, 0.3, 0.3)"},enter:function(t,n){setTimeout(function(){t.style.opacity=null,t.style.transform="rotate("+l+"rad)"},1),setTimeout(n,i)},leave:function(t,n){t.style.opacity=0,t.style.transform+=" scale3d(0.3, 0.3, 0.3)",setTimeout(n,i)}}},[t(v,{key:s,style:{position:"absolute",left:p+"px",top:g+"px",transform:"rotate("+l+"rad)",color:m,font:d,transition:["all",o+"ms",r,u*a+"ms"].join(" ")}},[t(v,{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[e.default({word:f,text:c,weight:h,font:d,color:m,left:p,top:g})])])])}))])}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(m.name,m),m});
