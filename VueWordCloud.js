!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";var t=function(t){return function(){return t}},e=function(t){return"function"==typeof t},n=function(){return[]},r=function(t){return t&&"object"==typeof t},i=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},a=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})},f=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})},u=function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},c=function(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]},h=function(t){return 2*t*Math.PI},s=function(t,e,n,r,i,o){var a=function(t,e,n){for(var r=[],i=0;i<e;++i)for(var o=0;o<n;++o)t[e*o+i]&&r.push([i,o]);return r}(r,i,o);return function(t,e,n){if(t>0&&e>0){var r,i;t>e?(r=1,i=e/t):e>t?(i=1,r=t/e):r=i=1;var o=Math.floor(t/2),a=Math.floor(e/2),f=t-o,u=e-a;if(o<f)for(var c=o;c<=f;++c){var h=[c,a];if(n(h))return h}else if(a<u)for(var s=a;s<=u;++s){var l=[o,s];if(n(l))return l}for(var d=o,v=a,g=f,p=u;f<t||u<e;){o-=r,a-=i,f+=r,u+=i;var m=Math.floor(o),y=Math.floor(a),W=Math.ceil(f),w=Math.ceil(u);if(W>g)for(var x=y;x<w;++x){var M=[W,x];if(n(M))return M}if(w>p)for(var S=W;S>m;--S){var F=[S,w];if(n(F))return F}if(m<d)for(var b=w;b>y;--b){var z=[m,b];if(n(z))return z}if(y<v)for(var H=m;H<W;++H){var T=[H,y];if(n(T))return T}d=m,v=y,g=W,p=w}}}(e-i,n-o,function(n){for(var r=n[0],i=n[1],o=0,f=a.length;o<f;++o){var u=a[o],c=u[0],h=u[1];if(t[e*(h+i)+(c+r)])return!1}return!0})},l=function(t,e,n,r){for(var i=e/r,o=n/r,a=new Uint8Array(i*o),f=0;f<i;++f)for(var u=0;u<o;++u)t:for(var c=0;c<r;++c)for(var h=0;h<r;++h){var s=t[e*(u*r+h)+(f*r+c)];if(s){a[i*u+f]=s;break t}}return[a,i,o]},d=function(t,e,n,r,i,o,a,f){for(var u=0;u<a;++u)for(var c=0;c<f;++c){var h=o[a*c+u];if(h){t[e*(c+i)+(u+r)]=h}}},v=function(t,e,n,r){if(e>0&&n>0){var i=Object.values(t);if(i.length>0){var v=e/n,g=function(t,e){var n={};if(t.length>0){var r=a(t,function(t){return t.weight}),i=f(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=u(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=u(a,r,i,1,o)})}}return n}(i,r);return Promise.all(i.map(function(t){var e=t.key,n=t.text,r=t.rotation,i=t.fontFamily,a=t.fontStyle,f=t.fontVariant,u=t.fontWeight;return function(t){return void 0===t&&(t=0),new Promise(function(e){setTimeout(e,t)})}(1).then(function(){var t=Math.pow(3,2)*g[e]+1,s=function(t,e,n,r,i,o,a){a=h(a);var f=[e,n,r,i+"px",o].join(" "),u=document.createElement("canvas").getContext("2d");u.font=f;var s=u.measureText(t).width,l=i,d=c(s,l,a),v=d[0],g=d[1],p=Math.max(u.measureText("m").width,i),m=c(s+2*p,l+2*p,a);return[s,l,v,g,m[0],m[1]]}(n,a,f,u,t,i,r),l=s[0],d=s[1],v=s[2],p=s[3],m=s[4],y=s[5],W=o(m),w=o(y),x=function(t,e,n,r,i,o,a,f,u){u=h(u);var c=[e,n,r,i+"px",o].join(" "),s=document.createElement("canvas").getContext("2d");s.canvas.width=a,s.canvas.height=f,s.translate(a/2,f/2),s.rotate(u),s.font=c,s.textAlign="center",s.textBaseline="middle",s.fillText(t,0,0);for(var l=new Uint8Array(a*f),d=s.getImageData(0,0,a,f).data,v=0,g=l.length;v<g;++v)l[v]=d[4*v+3];return l}(n,a,f,u,t,i,W,w,r),M=Math.log2(Math.min(W,w)/Math.pow(4,2));return{key:e,fontSize:t,textWidth:l,textHeight:d,rectWidth:v,rectHeight:p,image:x,imageWidth:W,imageHeight:w,cccc:M}})})).then(function(t){return function(t,e){return t.map(function(t){return[e(t),t]}).sort(function(t,e){var n=t[0],r=e[0];return n>r?1:n<r?-1:0}).map(function(t){return t[1]})}(t,function(t){return-t.cccc})}).then(function(e){var n,r=[];return e.forEach(function(e){for(var i=e.key,o=e.fontSize,a=e.textWidth,f=e.textHeight,u=e.rectWidth,c=e.rectHeight,h=e.image,g=e.imageWidth,p=e.imageHeight,m=e.cccc,y=[[h,g,p]],W=1;W<m;++W){var w;h=(w=l(h,g,p,2))[0],g=w[1],p=w[2],y.push([h,g,p])}if(void 0===n){var x=Math.pow(2,16),M=Math.floor(Math.sqrt(v*x)),S=Math.floor(x/M),F=new Uint8Array(M*S);n=[[F,M,S]];for(var b=1;b<y.length;++b)M*=2,S*=2,F=new Uint8Array(M*S),n.unshift([F,M,S])}var z=n[y.length-1],H=z[0],T=z[1],C=z[2],k=s(H,T,C,h,g,p),j=k[0],V=k[1];d(H,T,0,j,V,h,g,p);for(var E=y.length-1;E-- >0;){j*=2,V*=2;var O;H=(O=n[E])[0],T=O[1],C=O[2];var A;h=(A=y[E])[0],g=A[1],p=A[2],d(H,T,0,j,V,h,g,p)}var P=j+(g-u)/2,U=V+(p-c)/2;r.push(Object.assign({fontSize:o,textWidth:a,textHeight:f,rectLeft:P,rectTop:U,rectWidth:u,rectHeight:c},t[i]))}),r})}}return[]},g={boundedWords:{get:function(){return v(this.keyedPopulatedWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},default:n}},p={name:"VueWordCloud",props:{words:{type:Array,default:n},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){var t=this,n={containerWidth:0,containerHeight:0};return Object.entries(g).forEach(function(i){var o=i[0],a=i[1].default;e(a)&&(a=a.call(t)),r(a)&&(a=Object.freeze(a)),n["fulfilled$"+o]=a}),n},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,o,a,f,u,c,h){var s={};return t.forEach(function(t){var l,d,v,g,p,m,y,W,w;if(t)if("string"==typeof t)d=t;else if(Array.isArray(t)){var x;d=(x=t)[0],v=x[1]}else if(r(t)){var M;l=(M=t).key,d=M.text,v=M.weight,g=M.rotation,p=M.fontFamily,m=M.fontStyle,y=M.fontVariant,W=M.fontWeight,w=M.color}for(void 0===d&&(d=e(t)),void 0===v&&(v=n(t)),void 0===g&&(g=o(t)),void 0===p&&(p=a(t)),void 0===m&&(m=f(t)),void 0===y&&(y=u(t)),void 0===W&&(W=c(t)),void 0===w&&(w=h(t)),void 0===l&&(l=JSON.stringify([d,p,m,y,W]));i(s,l);)l+="!";s[l]={originalWord:t,key:l,text:d,weight:v,rotation:g,fontFamily:p,fontStyle:m,fontVariant:y,fontWeight:W,color:w}}),s}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},scaledBoundedWords:function(){return function(t,e,n,r){var i=a(t,function(t){return t.rectLeft}),o=f(t,function(t){return t.rectLeft+t.rectWidth}),u=o-i,c=a(t,function(t){return t.rectTop}),h=f(t,function(t){return t.rectTop+t.rectHeight}),s=h-c,l=Math.min(e/u,n/s),d=f(t,function(t){return t.fontSize})*l;return d>r&&(l*=r/d),t.map(function(t){var r=t.fontSize,a=t.textWidth,f=t.textHeight,u=t.rectLeft,s=t.rectTop,d=t.rectWidth,v=t.rectHeight;return r*=l,a*=l,f*=l,u=(u-(i+o)/2)*l+e/2,s=(s-(c+h)/2)*l+n/2,d*=l,v*=l,Object.assign({},t,{fontSize:r,textWidth:a,textHeight:f,rectLeft:u,rectTop:s,rectWidth:d,rectHeight:v})})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},beforeCreate:function(){var t=this;Object.entries(g).forEach(function(e){var n=e[0],r=e[1],i=r.errorHandler||function(){};t.$options.computed[n]=function(){var t=this;return Promise.resolve(this["promised$"+n]).then(function(e){t["fulfilled$"+n]=e}).catch(i),this["fulfilled$"+n]};var o;t.$options.computed["promised$"+n]=function(){var t=this,e=o={};return Promise.resolve(r.get.call(this)).then(function(n){if(e!==o||t._isDestroyed)throw new Error;return n})}})},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%"}},n.map(function(n){var i=n.originalWord,o=n.key,a=n.text,f=n.weight,u=n.rotation,c=n.fontFamily,h=n.fontStyle,s=n.fontVariant,l=n.fontWeight,d=n.color,v=n.fontSize,g=(n.textWidth,n.textHeight,n.rectLeft),p=n.rectTop,m=n.rectWidth,y=n.rectHeight;return t("div",{key:o,style:{position:"absolute",top:p+y/2+"px",left:g+m/2+"px",transform:"rotate("+u+"turn)",color:d,transitionDuration:Math.round(r)+"ms",transitionProperty:"all",font:[h,s,l,v+"px/1",c].join(" ")}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[e.default({originalWord:i,text:a,weight:f,rotation:u,fontFamily:c,fontStyle:h,fontVariant:s,fontWeight:l,color:d,fontSize:v})])])}))}(t,Object.assign({default:function(t){return t.text}},this.$scopedSlots),this.scaledBoundedWords,this.animationDuration)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(p.name,p),p});
