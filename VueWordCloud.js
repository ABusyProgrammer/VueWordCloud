!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.VueWordCloud=n()}(this,function(){"use strict";function t(t){return"function"==typeof t}function n(){}var i=function(t){this.previousValue=t,this.interrupted=!1,this.interruptHandlers=new Set};i.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},i.prototype.interrupt=function(){this.interrupted||(this.interrupted=!0,this.interruptHandlers.forEach(function(t){try{t()}catch(t){}}))},i.prototype.onInterrupt=function(t){if(this.interrupted&&!this.interruptHandlers.has(t))try{t()}catch(t){}this.interruptHandlers.add(t)};var r="asyncComputed_promise_",e="asyncComputed_trigger_";var o=function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){o.call(t)})},this.intervalBetweenUpdateElementSize),function(){this.elementWidth=this.$el.offsetWidth,this.elementHeight=this.$el.offsetHeight}.call(this))};function u(){return[]}var a={words:{type:Array,default:u},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[Number,Function],default:0},rotationUnit:{type:[String,Function],default:"turn"},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function,Array],default:"Black"},spacing:{type:Number,default:0},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},renderingFontSizeInterval:{type:Number,default:2},renderingFontSizeBase:{type:Number,default:4},animationDuration:{type:Number,default:5e3},createCanvas:{type:Function,default:function(){return document.createElement("canvas")}},loadFont:{type:Function,default:function(t,n,i,r){return document.fonts.load([n,i,"1px",t].join(" "),r)}},createWorker:{type:Function,default:function(t){return new Worker(URL.createObjectURL(new Blob([t])))}}};function f(n){return t(n)?n:function(t){return function(){return t}}(n)}function s(t){return void 0===t}function c(t,n){return t.postMessage(n),function(t){return new Promise(function(n,i){var r,e=function(t){var i=t.data;r(),n(i)},o=function(t){var n=t.error;r(),i(n)};r=function(){t.removeEventListener("message",e),t.removeEventListener("error",o)},t.addEventListener("message",e),t.addEventListener("error",o)})}(t)}var h=function(t,n,i,r,e,o,u){this.t=t,this.n=n,this.i=i,this.r=r,this.e=e,this.o=o,this.u=u,this.a=1,this.f=0,this.s=0,this.c=0},l={h:{configurable:!0},l:{configurable:!0},d:{configurable:!0},v:{configurable:!0},m:{configurable:!0},p:{configurable:!0},g:{configurable:!0},y:{configurable:!0},b:{configurable:!0},M:{configurable:!0},w:{configurable:!0},F:{configurable:!0},S:{configurable:!0},W:{configurable:!0},x:{configurable:!0},P:{configurable:!0}};l.h.get=function(){return this.a},l.h.set=function(t){this.a!==t&&(this.a=t,this.L=void 0)},l.l.get=function(){return t=this.r,n=this.e,i=this.o,r=this.h,e=this.i,[t,n,i,r+"px",e].join(" ");var t,n,i,r,e},l.d.get=function(){var t,n,i,r;return void 0===this.j&&(this.j=(t=this.t,n=this.l,i=this.u,(r=i().getContext("2d")).font=n,r.measureText(t).width/this.h)),this.j},l.v.get=function(){return this.d*this.h},l.m.get=function(){return this.s*this.h},l.m.set=function(t){this.s=t/this.h},l.p.get=function(){return this.c*this.h},l.p.set=function(t){this.c=t/this.h},l.g.get=function(){return this.f},l.g.set=function(t){this.f!==t&&(this.f=t,this.L=void 0)},l.y.get=function(){return this.g*this.h},l.b.get=function(){var t,n,i;return void 0===this.L&&(this.L=function(t,n,i,r,e,o,u){var a=u(),f=a.getContext("2d");a.width=e,a.height=o,f.translate(e/2,o/2),f.rotate(r),f.font=n,f.textAlign="center",f.textBaseline="middle",f.fillText(t,0,0),i>0&&(f.miterLimit=1,f.lineWidth=i,f.strokeText(t,0,0));for(var s=f.getImageData(0,0,e,o).data,c=[],h=1/0,l=0,d=1/0,v=0,m=0;m<e;++m)for(var p=0;p<o;++p)s[4*(e*p+m)+3]&&(c.push([m,p]),h=Math.min(m,h),l=Math.max(m+1,l),d=Math.min(p,d),v=Math.max(p+1,v));return c.length<1?[c,0,0,0,0]:[c.map(function(t){var n=t[0],i=t[1];return[n-h,i-d]}),l-h,v-d,Math.ceil(e/2)-h,Math.ceil(o/2)-d]}(this.t,this.l,2*this.y,this.n,(t=this.v+2*(this.y+this.h),n=this.h+2*(this.y+this.h),i=this.n,Math.ceil(t*Math.abs(Math.cos(i))+n*Math.abs(Math.sin(i)))),function(t,n,i){return Math.ceil(t*Math.abs(Math.sin(i))+n*Math.abs(Math.cos(i)))}(this.v+2*(this.y+this.h),this.h+2*(this.y+this.h),this.n),this.u)),this.L},l.M.get=function(){return this.b[0]},l.w.get=function(){return this.b[1]},l.F.get=function(){return this.b[2]},l.S.get=function(){return this.b[3]},l.W.get=function(){return this.b[4]},l.x.get=function(){return Math.ceil(this.m)-this.S},l.x.set=function(t){this.m=t+this.S},l.P.get=function(){return Math.ceil(this.p)-this.W},l.P.set=function(t){this.p=t+this.W},Object.defineProperties(h.prototype,l);var d={progress:{handler:function(t){this.$emit("update:progress",t)},deep:!0,immediate:!0}};var v={name:"VueWordCloud",mixins:[function(o){var u=new Set,a={data:function(){var t={};return Object.keys(o).forEach(function(n){t[e+n]={}}),t},computed:{},beforeDestroy:function(){u.forEach(function(t){t.interrupt()}),u.clear()}};return Object.entries(o).forEach(function(o){var f=o[0],s=o[1],c=s.get,h=s.default,l=s.errorHandler;void 0===l&&(l=n);var d,v=!0;a.computed[f]=function(){return this[e+f],this[r+f],h},a.computed[r+f]=function(){var n=this;d&&(d.interrupt(),u.delete(d)),v&&(v=!1,t(h)&&(h=h.call(this)));var r=new i(h);d=r,u.add(d),new Promise(function(t){t(c.call(n,r))}).then(function(t){r.throwIfInterrupted(),h=t,n[e+f]={}}).catch(l)}}),a}({cloudWords:{get:function(t){var n,i,r,e,o=this,u=this.elementWidth,a=this.elementHeight,l=(i=(n=[u,a])[0],r=n[1],i>r?[1,r/i]:r>i?[i/r,1]:[1,1]),d=this.words,v=this.text,m=this.weight,p=this.rotation,g=this.rotationUnit,y=this.fontFamily,b=this.fontStyle,M=this.fontVariant,w=this.fontWeight,F=this.color,S=this.spacing,W=(e=this.fontSizeRatio,(e=Math.abs(e))>1?1/e:e),x=this.renderingFontSizeInterval,P=this.renderingFontSizeBase,L=this.createCanvas,j=this.loadFont,N=this.createWorker;if(!(u>0&&a>0))return[];var T=f(v),k=f(m),H=f(p),z=f(g),E=f(y),O=f(b),q=f(M),A=f(w),B=f(F);return d=d.map(function(t,n){var i,r,e,o,u,a,f,c,l,v,m;t&&("string"==typeof t?e=t:Array.isArray(t)?(e=(i=t)[0],o=i[1]):function(t){return t&&"object"==typeof t}(t)&&(e=(r=t).text,o=r.weight,u=r.rotation,a=r.rotationUnit,f=r.fontFamily,c=r.fontStyle,l=r.fontVariant,v=r.fontWeight,m=r.color)),s(e)&&(e=T(t,n,d)),s(o)&&(o=k(t,n,d)),s(u)&&(u=H(t,n,d)),s(a)&&(a=z(t,n,d)),s(f)&&(f=E(t,n,d)),s(c)&&(c=O(t,n,d)),s(l)&&(l=q(t,n,d)),s(v)&&(v=A(t,n,d)),s(m)&&(m=B(t,n,d));var p=new h(e,function(){switch(a){case"turn":return u*Math.PI*2;case"deg":return function(t){return t*Math.PI/180}(u)}return u}(),f,c,l,v,L);return Object.assign(p,{N:t,T:o,k:m}),p}),Promise.resolve().then(function(){return Promise.all(d.map(function(t){var n=t.i,i=t.r,r=t.o,e=t.t;return j(n,i,r,e)}))}).then(function(){if(!((d=d.filter(function(t){return t.v>0}).sort(function(t,n){return n.T-t.T})).length>0))return[];var n=d[0],i=function(t){return t[t.length-1]}(d),r=n.T,e=i.T;if(e<r){var f=W>0?1/W:e>0?r/e:r<0?e/r:1+r-e;d.forEach(function(t){var n,i,o;t.h=(n=t.T,(o=1)+(n-(i=e))*(f-o)/(r-i))})}d.reduceRight(function(t,n){return n.h<x*t?n.h/=t:(t=n.h,n.h=1),n.H=t},1),d.forEach(function(t){t.h*=P});var s=N('!function(){"use strict";var r=function(t){self.removeEventListener("message",r);var n,f,a,e,u,i=t.data,o=function(){n={},f=0,a=0,e=0,u=0};o();var v=function(){return Math.ceil((f+a)/2)},c=function(){return Math.ceil((e+u)/2)},s=function(r,t,f){return function(r,t,n){var f,a,e=r[0],u=r[1],i=t[0],o=t[1];e>u?(f=1,a=u/e):u>e?(a=1,f=e/u):f=a=1;var v=[i,o];if(n(v))return v;for(var c=i,s=o,h=i,M=o,g=c,l=s;;){i-=f,o-=a,c+=f,s+=a;var m=Math.floor(i),d=Math.floor(o),p=Math.ceil(c),F=Math.ceil(s);if(p>g)for(var H=d;H<F;++H){var L=[p,H];if(n(L))return L}if(F>l)for(var T=p;T>m;--T){var W=[T,F];if(n(W))return W}if(m<h)for(var b=F;b>d;--b){var j=[m,b];if(n(j))return j}if(d<M)for(var k=m;k<p;++k){var q=[k,d];if(n(q))return q}h=m,M=d,g=p,l=F}}(i,[t+v(),f+c()],function(t){var f=t[0],a=t[1];return function(r,t,f){return r.every(function(r){var a=r[0],e=r[1];return!n[t+a+"|"+(f+e)]})}(r,f,a)})};self.postMessage({}),self.addEventListener("message",function(r){self.postMessage({getLeft:v,getTop:c,getWidth:function(){return a-f},getHeight:function(){return u-e},put:function(r,t,i){r.forEach(function(r){var o=r[0],v=r[1],c=t+o,s=i+v;n[c+"|"+s]=!0,f=Math.min(c,f),a=Math.max(c+1,a),e=Math.min(s,e),u=Math.max(s+1,u)})},findFit:s,clear:o}[r.data.name].apply(null,r.data.args))})};self.addEventListener("message",r)}();\n'),h={completedWords:0,totalWords:d.length};return Promise.resolve().then(function(){return t.throwIfInterrupted(),o.progress=h,c(s,l)}).then(function(){t.throwIfInterrupted(),h.completedWords++;var n=Promise.resolve();return d.reduce(function(i,r,e){return n=n.then(function(){return r.H<i.H?Promise.resolve().then(function(){return c(s,{name:"clear"})}).then(function(){var t=Promise.resolve(),n=i.H/r.H;return d.slice(0,e).forEach(function(i){t=t.then(function(){return i.h*=n,c(s,{name:"put",args:[i.M,i.x,i.P]})})}),t}):c(s,{name:"put",args:[i.M,i.x,i.P]})}).then(function(){return r.g=S,c(s,{name:"findFit",args:[r.M,r.x,r.P]})}).then(function(n){var i=n[0],e=n[1];t.throwIfInterrupted(),h.completedWords++,r.x=i,r.P=e,r.g=0}),r}),n}).then(function(){return c(s,{name:"put",args:[i.M,i.x,i.P]})}).then(function(){var t=Promise.resolve();return Promise.all([t=t.then(function(){return c(s,{name:"getWidth"})}),t=t.then(function(){return c(s,{name:"getHeight"})}),t=t.then(function(){return c(s,{name:"getLeft"})}),t=t.then(function(){return c(s,{name:"getTop"})})])}).then(function(t){var n=t[0],i=t[1],r=t[2],e=t[3];if(n>0&&i>0){var o=Math.min(u/n,a/i);d.forEach(function(t){t.m-=r,t.p-=e,t.h*=o})}var f=new Set;return d.map(function(t){for(var n=t.N,i=t.t,r=t.T,e=t.n,o=t.l,u=t.m,a=t.p,s=t.k,c=JSON.stringify([i,y,b,M,w]);f.has(c);)c+="!";return f.add(c),{key:c,word:n,text:i,weight:r,rotation:e,font:o,color:s,left:u,top:a}})}).finally(function(){s.terminate(),t.throwIfInterrupted(),o.progress=null})})},default:u}}),{props:{intervalBetweenUpdateElementSize:{type:Number,default:1e3}},data:function(){return{elementWidth:0,elementHeight:0}},mounted:function(){o.call(this)}}],props:a,data:function(){return{progress:null}},watch:d,render:function(t){var n=this.cloudWords,i=this.animationDuration,r=Object.assign({default:function(t){return t.text}},this.$scopedSlots),e=n.length>0?i/Math.min(4,n.length):0,o=n.length>1?(i-e)/(n.length-1):0;return t("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}},n.map(function(n,i){var u=n.word,a=n.key,f=n.text,s=n.weight,c=n.rotation,h=n.font,l=n.color,d=n.left,v=n.top;return t("div",{key:a,style:{position:"absolute",left:d+"px",top:v+"px",transform:"rotate("+c+"rad)",color:l,font:h,transition:["all",e+"ms","ease-in-out",o*i+"ms"].join(" ")}},[t("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",whiteSpace:"nowrap"}},[r.default({word:u,text:f,weight:s,font:h,color:l,left:d,top:v})])])}))])}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(v.name,v),v});
