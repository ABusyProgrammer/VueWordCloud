!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";function t(t){return function(){return t}}function e(t){return"function"==typeof t}function n(){return[]}function r(t){return t&&"object"==typeof t}function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(t){return Math.pow(2,Math.ceil(function(t){return Math.log(t)/Math.LN2}(t)))}function a(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})}function u(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})}function f(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function c(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]}function h(t){return 2*t*Math.PI}function s(t,e,n,r,i){if(n>0&&r>0&&e.length>0){var s=n/r,d=function(t,e){var n={};if(t.length>0){var r=a(t,function(t){return t.weight}),i=u(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=f(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=f(a,r,i,1,o)})}}return n}(e,i);e=e.map(function(t){var e=t.key,n=t.text,r=t.rotation,i=t.fontFamily,a=t.fontStyle,u=t.fontVariant,f=t.fontWeight,s=Math.pow(v-1,2)*d[e]+1,l=function(t,e,n,r,i,o,a){a=h(a);var u=[e,n,r,i+"px",o].join(" "),f=document.createElement("canvas").getContext("2d");f.font=u;var s=f.measureText(t).width,d=i,l=c(s,d,a),v=l[0],g=l[1],p=Math.max(f.measureText("m").width,i),m=c(s+2*p,d+2*p,a);return[s,d,v,g,m[0],m[1]]}(n,a,u,f,s,i,r),g=l[0],p=l[1],m=l[2],y=l[3],w=l[4],W=l[5],M=o(w),b=o(W),S=function(t,e,n,r,i,o,a,u,f){f=h(f);var c=[e,n,r,i+"px",o].join(" "),s=document.createElement("canvas").getContext("2d");s.canvas.width=a,s.canvas.height=u,s.translate(a/2,u/2),s.rotate(f),s.font=c,s.shadowColor="#000000",s.shadowBlur=i/32,s.textAlign="center",s.textBaseline="middle",s.fillText(t,0,0);for(var d=new Uint8Array(a*u),l=s.getImageData(0,0,a,u).data,v=0,g=d.length;v<g;++v)d[v]=l[4*v+3];return d}(n,a,u,f,s,i,M,b,r);return Object.assign({fontSize:s,textWidth:g,textHeight:p,rectWidth:m,rectHeight:y,image:S,imageWidth:M,imageHeight:b},t)});var g=new Worker(l),p=function(){g.terminate()};t.onInterrupt(p),g.postMessage({words:e.map(function(t){return{key:t.key,rectWidth:t.rectWidth,rectHeight:t.rectHeight,image:t.image,imageWidth:t.imageWidth,imageHeight:t.imageHeight}}),containerAspect:s,aaaa:v});var m=function(t){return new Promise(function(e,n){var r,i=function(t){r(t),e(t.data)},o=function(t){r(t),n(t)};r=function(e){e.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",o)},t.addEventListener("message",i),t.addEventListener("error",o)})}(g).then(function(t){var n={};return e.forEach(function(t){var e=t.key;n[e]=t}),t.forEach(function(t){var e=t.key;Object.assign(n[e],t)}),e});return m.then(p,p),m}return[]}var d=function(){this.interrupted=!1,this.interruptHandlers=new Set};d.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},d.prototype.interrupt=function(){this.interrupted||(this.interrupted=!1,this.interruptHandlers.forEach(function(t){t()}))},d.prototype.onInterrupt=function(t){this.interrupted&&(this.interruptHandlers.has(t)||t()),this.interruptHandlers.add(t)};var l=URL.createObjectURL(new Blob(['!function(){"use strict";function r(r,a,t,n,f,e){var o=function(r,a,t){for(var n=[],f=0;f<a;++f)for(var e=0;e<t;++e)r[a*e+f]&&n.push([f,e]);return n}(n,f,e);return function(r,a,t){if(r>0&&a>0){var n,f;r>a?(n=1,f=a/r):a>r?(f=1,n=r/a):n=f=1;var e=Math.floor(r/2),o=Math.floor(a/2),i=r-e,v=a-o;if(e<i)for(var c=e;c<=i;++c){var u=[c,o];if(t(u))return u}else if(o<v)for(var h=o;h<=v;++h){var s=[e,h];if(t(s))return s}for(var l=e,g=o,M=i,m=v;i<r||v<a;){e-=n,o-=f,i+=n,v+=f;var p=Math.floor(e),d=Math.floor(o),w=Math.ceil(i),y=Math.ceil(v);if(w>M)for(var A=d;A<y;++A){var k=[w,A];if(t(k))return k}if(y>m)for(var H=w;H>p;--H){var L=[H,y];if(t(L))return L}if(p<l)for(var U=y;U>d;--U){var W=[p,U];if(t(W))return W}if(d<g)for(var E=p;E<w;++E){var b=[E,d];if(t(b))return b}l=p,g=d,M=w,m=y}}}(a-f,t-e,function(t){for(var n=t[0],f=t[1],e=0,i=o.length;e<i;++e){var v=o[e],c=v[0],u=v[1];if(r[a*(u+f)+(c+n)])return!1}return!0})}function a(r,a,t,n){for(var f=a/n,e=t/n,o=new Uint8Array(f*e),i=0;i<f;++i)for(var v=0;v<e;++v)r:for(var c=0;c<n;++c)for(var u=0;u<n;++u){var h=r[a*(v*n+u)+(i*n+c)];if(h){o[f*v+i]=h;break r}}return[o,f,e]}function t(r,a,t,n,f,e,o,i){for(var v=0;v<o;++v)for(var c=0;c<i;++c){var u=e[o*c+v];if(u){r[a*(c+f)+(v+n)]=u}}}self.addEventListener("message",function(n){var f=n.data,e=f.words,o=f.containerAspect,i=f.aaaa;e.forEach(function(r){var a=r.imageWidth,t=r.imageHeight;r.cccc=function(r){return Math.log(r)/Math.LN2}(Math.min(a,t)/Math.pow(i,2))});var v,c=(e=function(r,a){return r.map(function(r){return[a(r),r]}).sort(function(r,a){var t=r[0],n=a[0];return t>n?1:t<n?-1:0}).map(function(r){return r[1]})}(e,function(r){return-r.cccc})).map(function(n){for(var f=n.key,e=n.rectWidth,i=n.rectHeight,c=n.image,u=n.imageWidth,h=n.imageHeight,s=n.cccc,l=[[c,u,h]],g=1;g<s;++g){var M;c=(M=a(c,u,h,2))[0],u=M[1],h=M[2],l.push([c,u,h])}if(void 0===v){var m=Math.pow(2,16),p=Math.floor(Math.sqrt(o*m)),d=Math.floor(m/p),w=new Uint8Array(p*d);v=[[w,p,d]];for(var y=1;y<l.length;++y)p*=2,d*=2,w=new Uint8Array(p*d),v.unshift([w,p,d])}var A=v[l.length-1],k=A[0],H=A[1],L=A[2],U=r(k,H,L,c,u,h),W=U[0],E=U[1];t(k,H,0,W,E,c,u,h);for(var b=l.length-1;b-- >0;){W*=2,E*=2;var q;k=(q=v[b])[0],H=q[1],L=q[2];var N;t(k,H,0,W,E,c=(N=l[b])[0],u=N[1],h=N[2])}return{key:f,rectLeft:W+(u-e)/2,rectTop:E+(h-i)/2}});self.postMessage(c)})}();\n'])),v=4,g={boundedWords:{get:function(t){return s(t,this.populatedWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},default:n}},p={name:"VueWordCloud",props:{words:{type:Array,default:n},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){var t=this,n={containerWidth:0,containerHeight:0};return Object.entries(g).forEach(function(i){var o=i[0],a=i[1].default;e(a)&&(a=a.call(t)),r(a)&&(a=Object.freeze(a)),n["fulfilled$"+o]=a}),n},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,o,a,u,f,c,h){var s={};return t.forEach(function(t){var d,l,v,g,p,m,y,w,W;if(t)if(function(t){return"string"==typeof t}(t))l=t;else if(Array.isArray(t)){var M;l=(M=t)[0],v=M[1]}else if(r(t)){var b;d=(b=t).key,l=b.text,v=b.weight,g=b.rotation,p=b.fontFamily,m=b.fontStyle,y=b.fontVariant,w=b.fontWeight,W=b.color}for(void 0===l&&(l=e(t)),void 0===v&&(v=n(t)),void 0===g&&(g=o(t)),void 0===p&&(p=a(t)),void 0===m&&(m=u(t)),void 0===y&&(y=f(t)),void 0===w&&(w=c(t)),void 0===W&&(W=h(t)),void 0===d&&(d=JSON.stringify([l,p,m,y,w]));i(s,d);)d+="!";s[d]={originalWord:t,key:d,text:l,weight:v,rotation:g,fontFamily:p,fontStyle:m,fontVariant:y,fontWeight:w,color:W}}),s}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},populatedWords:function(){return Object.values(this.keyedPopulatedWords)},scaledBoundedWords:function(){return function(t,e,n,r){var i=a(t,function(t){return t.rectLeft}),o=u(t,function(t){return t.rectLeft+t.rectWidth}),f=o-i,c=a(t,function(t){return t.rectTop}),h=u(t,function(t){return t.rectTop+t.rectHeight}),s=h-c,d=Math.min(e/f,n/s),l=u(t,function(t){return t.fontSize})*d;return l>r&&(d*=r/l),t.map(function(t){var e=t.fontSize,n=t.textWidth,r=t.textHeight,a=t.rectLeft,u=t.rectTop,f=t.rectWidth,s=t.rectHeight;return e*=d,n*=d,r*=d,a=(a-(i+o)/2)*d,u=(u-(c+h)/2)*d,f*=d,s*=d,Object.assign({},t,{fontSize:e,textWidth:n,textHeight:r,rectLeft:a,rectTop:u,rectWidth:f,rectHeight:s})})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},beforeCreate:function(){var t=this;Object.entries(g).forEach(function(e){var n=e[0],i=e[1],o=i.errorHandler||function(){};t.$options.computed[n]=function(){var t=this;return Promise.resolve(this["promised$"+n]).then(function(e){r(e)&&(e=Object.freeze(e)),t["fulfilled$"+n]=e}).catch(o),this["fulfilled$"+n]};var a=new d;t.$options.computed["promised$"+n]=function(){var t=this;a.interrupt();var e=a=new d;return Promise.resolve(i.get.call(this,e)).then(function(n){if(t._isDestroyed)throw new Error;return e.throwIfInterrupted(),n})}})},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},n.map(function(n){var i=n.originalWord,o=n.key,a=n.text,u=n.weight,f=n.rotation,c=n.fontFamily,h=n.fontStyle,s=n.fontVariant,d=n.fontWeight,l=n.color,v=n.fontSize,g=(n.textWidth,n.textHeight,n.rectLeft),p=n.rectTop,m=n.rectWidth,y=n.rectHeight;return t("div",{key:o,style:{position:"absolute",top:p+y/2+"px",left:g+m/2+"px",transform:"rotate("+f+"turn)",color:l,transitionDuration:Math.round(r)+"ms",transitionProperty:"all",font:[h,s,d,v+"px/1",c].join(" ")}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[e.default({originalWord:i,text:a,weight:u,rotation:f,fontFamily:c,fontStyle:h,fontVariant:s,fontWeight:d,color:l,fontSize:v})])])}))])}(t,Object.assign({default:function(t){return t.text}},this.$scopedSlots),this.scaledBoundedWords,this.animationDuration)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(p.name,p),p});
