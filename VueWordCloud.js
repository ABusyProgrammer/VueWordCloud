!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";var t=function(t){return function(){return t}},e=function(t){return"function"==typeof t},n=function(){},r=function(t){return t&&"object"==typeof t},i=function(t,e){if(t===e)return!0;if(Array.isArray(t)){if(Array.isArray(e)&&t.length===e.length)return t.every(function(t,n){return i(t,e[n])})}else if(r(t)&&r(e)){var n=Object.entries(t);if(n.length===Object.keys(e).length)return n.every(function(t){var n=t[0],r=t[1];return i(r,e[n])})}return!1},o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a=function(t){return function(t,e){var n={};return Object.entries(t).forEach(function(t){var r=t[0],i=t[1];n[r]=e(i,r)}),n}(t,function(t){return{key:t.key,text:t.text,weight:t.weight,rotation:t.rotation,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontVariant:t.fontVariant,fontWeight:t.fontWeight}})},f=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},u=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})},c=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})},h=function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},d=function(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]},s=function(t){return 2*t*Math.PI},l=function(t,e,n,r,i,o){var a=function(t,e,n){for(var r=[],i=0;i<e;++i)for(var o=0;o<n;++o)t[e*o+i]&&r.push([i,o]);return r}(r,i,o);return function(t,e,n){if(t>0&&e>0){var r,i;t>e?(r=1,i=e/t):e>t?(i=1,r=t/e):r=i=1;var o=Math.floor(t/2),a=Math.floor(e/2),f=t-o,u=e-a;if(o<f)for(var c=o;c<=f;++c){var h=[c,a];if(n(h))return h}else if(a<u)for(var d=a;d<=u;++d){var s=[o,d];if(n(s))return s}for(var l=o,g=a,v=f,y=u;f<t||u<e;){o-=r,a-=i,f+=r,u+=i;var p=Math.floor(o),m=Math.floor(a),W=Math.ceil(f),w=Math.ceil(u);if(W>v)for(var x=m;x<w;++x){var S=[W,x];if(n(S))return S}if(w>y)for(var M=W;M>p;--M){var b=[M,w];if(n(b))return b}if(p<l)for(var F=w;F>m;--F){var k=[p,F];if(n(k))return k}if(m<g)for(var z=p;z<W;++z){var H=[z,m];if(n(H))return H}l=p,g=m,v=W,y=w}}}(e-i,n-o,function(n){for(var r=n[0],i=n[1],o=0,f=a.length;o<f;++o){var u=a[o],c=u[0],h=u[1];if(t[e*(h+i)+(c+r)])return!1}return!0})},g=function(t,e,n,r){for(var i=e/r,o=n/r,a=new Uint8Array(i*o),f=0;f<i;++f)for(var u=0;u<o;++u)t:for(var c=0;c<r;++c)for(var h=0;h<r;++h){var d=t[e*(u*r+h)+(f*r+c)];if(d){a[i*u+f]=d;break t}}return[a,i,o]},v=function(t,e,n,r,i,o,a,f){for(var u=0;u<a;++u)for(var c=0;c<f;++c){var h=o[a*c+u];if(h){t[e*(c+i)+(u+r)]=h}}},y=function(t,e,n,r){var i=[];if(e>0&&n>0&&t.length>0){var o,a=e/n,y=function(t,e){var n={};if(t.length>0){var r=u(t,function(t){return t.weight}),i=c(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=h(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=h(a,r,i,1,o)})}}return n}(t,r);(t=function(t,e){return t.map(function(t){return[e(t),t]}).sort(function(t,e){var n=t[0],r=e[0];return n>r?1:n<r?-1:0}).map(function(t){return t[1]})}(t=t.map(function(t){var e=t.key,n=t.text,r=t.rotation,i=t.fontFamily,o=t.fontStyle,a=t.fontVariant,u=t.fontWeight,c=Math.pow(3,2)*y[e]+1,h=function(t,e,n,r,i,o,a){a=s(a);var f=[e,n,r,i+"px",o].join(" "),u=document.createElement("canvas").getContext("2d");u.font=f;var c=u.measureText(t).width,h=i,l=d(c,h,a),g=l[0],v=l[1],y=Math.max(u.measureText("m").width,i),p=d(c+2*y,h+2*y,a);return[c,h,g,v,p[0],p[1]]}(n,o,a,u,c,i,r),l=h[0],g=h[1],v=h[2],p=h[3],m=h[4],W=h[5],w=f(m),x=f(W);return{key:e,fontSize:c,textWidth:l,textHeight:g,rectWidth:v,rectHeight:p,image:function(t,e,n,r,i,o,a,f,u){u=s(u);var c=[e,n,r,i+"px",o].join(" "),h=document.createElement("canvas").getContext("2d");h.canvas.width=a,h.canvas.height=f,h.translate(a/2,f/2),h.rotate(u),h.font=c,h.textAlign="center",h.textBaseline="middle",h.fillText(t,0,0);for(var d=new Uint8Array(a*f),l=h.getImageData(0,0,a,f).data,g=0,v=d.length;g<v;++g)d[g]=l[4*g+3];return d}(n,o,a,u,c,i,w,x,r),imageWidth:w,imageHeight:x,cccc:Math.log2(Math.min(w,x)/Math.pow(4,2))}}),function(t){return-t.cccc})).forEach(function(t){for(var e=t.key,n=t.fontSize,r=t.textWidth,f=t.textHeight,u=t.rectWidth,c=t.rectHeight,h=t.image,d=t.imageWidth,s=t.imageHeight,y=t.cccc,p=[[h,d,s]],m=1;m<y;++m){var W;h=(W=g(h,d,s,2))[0],d=W[1],s=W[2],p.push([h,d,s])}if(void 0===o){var w=Math.pow(2,16),x=Math.floor(Math.sqrt(a*w)),S=Math.floor(w/x),M=new Uint8Array(x*S);o=[[M,x,S]];for(var b=1;b<p.length;++b)x*=2,S*=2,M=new Uint8Array(x*S),o.unshift([M,x,S])}var F=o[p.length-1],k=F[0],z=F[1],H=F[2],B=l(k,z,H,h,d,s),T=B[0],V=B[1];v(k,z,0,T,V,h,d,s);for(var j=p.length-1;j-- >0;){T*=2,V*=2;var C;k=(C=o[j])[0],z=C[1],H=C[2];var A;h=(A=p[j])[0],d=A[1],s=A[2],v(k,z,0,T,V,h,d,s)}var O=T+(d-u)/2,U=V+(s-c)/2;i.push({key:e,fontSize:n,textWidth:r,textHeight:f,rectLeft:O,rectTop:U,rectWidth:u,rectHeight:c})})}return i},p={name:"VueWordCloud",props:{words:{type:Array,default:function(){return[]}},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){return{containerWidth:0,containerHeight:0,keyedBoundableWords:void 0,fulfilledBoundedWords:Object.freeze([])}},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,i,a,f,u,c,h){var d={};return t.forEach(function(t){var s,l,g,v,y,p,m,W,w;if(t)if("string"==typeof t)l=t;else if(Array.isArray(t)){var x;l=(x=t)[0],g=x[1]}else if(r(t)){var S;s=(S=t).key,l=S.text,g=S.weight,v=S.rotation,y=S.fontFamily,p=S.fontStyle,m=S.fontVariant,W=S.fontWeight,w=S.color}for(void 0===l&&(l=e(t)),void 0===g&&(g=n(t)),void 0===v&&(v=i(t)),void 0===y&&(y=a(t)),void 0===p&&(p=f(t)),void 0===m&&(m=u(t)),void 0===W&&(W=c(t)),void 0===w&&(w=h(t)),void 0===s&&(s=JSON.stringify([l,y,p,m,W]));o(d,s);)s+="!";d[s]={key:s,originalWord:t,text:l,weight:g,rotation:v,fontFamily:y,fontStyle:p,fontVariant:m,fontWeight:W,color:w}}),d}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},watchedKeyedBoundableWords:function(){return a(this.keyedPopulatedWords)},boundableWords:function(){return Object.values(this.keyedBoundableWords)},boundedWords:function(){var t=this;return Promise.resolve(this.promisedBoundedWords).then(function(e){t.fulfilledBoundedWords=Object.freeze(e)}).catch(n),this.fulfilledBoundedWords},promisedBoundedWords:function(){return y(this.boundableWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},scaledBoundedWords:function(){return function(t,e,n,r){var i=u(t,function(t){return t.rectLeft}),o=c(t,function(t){return t.rectLeft+t.rectWidth}),a=o-i,f=u(t,function(t){return t.rectTop}),h=c(t,function(t){return t.rectTop+t.rectHeight}),d=h-f,s=Math.min(e/a,n/d),l=c(t,function(t){return t.fontSize})*s;return l>r&&(s*=r/l),t.map(function(t){var r=t.key,a=t.fontSize,u=t.textWidth,c=t.textHeight,d=t.rectLeft,l=t.rectTop,g=t.rectWidth,v=t.rectHeight;return a*=s,u*=s,c*=s,d=(d-(i+o)/2)*s+e/2,l=(l-(f+h)/2)*s+n/2,g*=s,v*=s,{key:r,fontSize:a,textWidth:u,textHeight:c,rectLeft:d,rectTop:l,rectWidth:g,rectHeight:v}})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},watch:{watchedKeyedBoundableWords:{handler:function(t,e){i(t,e)||(this.keyedBoundableWords=Object.freeze(t))},immediate:!0}},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%"}},n.map(function(n){var i=n.key,o=n.fontSize,a=(n.textWidth,n.textHeight,n.rectLeft),f=n.rectTop,u=n.rectWidth,c=n.rectHeight,h=r[i],d=h.originalWord,s=h.text,l=h.weight,g=h.rotation,v=h.fontFamily,y=h.fontStyle,p=h.fontVariant,m=h.fontWeight,W=h.color;return t("div",{key:i,style:{position:"absolute",top:f+c/2+"px",left:a+u/2+"px",transform:"rotate("+g+"turn)"}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap",color:W,font:[y,p,m,o+"px/1",v].join(" ")}},[e.default({originalWord:d,text:s,weight:l,rotation:g,fontFamily:v,fontStyle:y,fontVariant:p,fontWeight:m,color:W,fontSize:o})])])}))}(t,Object.assign({default:function(t){return t.text}},this.$scopedSlots),this.scaledBoundedWords,this.keyedPopulatedWords)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(p.name,p),p});
