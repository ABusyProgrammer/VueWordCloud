!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.VueWordCloud=n()}(this,function(){"use strict";function t(t){return"function"==typeof t}function n(){}var i=function(t){this.previousValue=t,this.interrupted=!1,this.interruptHandlers=new Set};i.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},i.prototype.interrupt=function(){this.interrupted||(this.interrupted=!0,this.interruptHandlers.forEach(function(t){try{t()}catch(t){}}))},i.prototype.onInterrupt=function(t){if(this.interrupted&&!this.interruptHandlers.has(t))try{t()}catch(t){}this.interruptHandlers.add(t)};var r="asyncComputed_promise_",e="asyncComputed_trigger_";function o(){return[]}var u={words:{type:Array,default:o},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[Number,Function],default:0},rotationUnit:{type:[String,Function],default:"turn"},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function,Array],default:"Black"},spacing:{type:Number,default:0},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},animationEasing:{type:String,default:"ease"},createCanvas:{type:Function,default:function(){return document.createElement("canvas")}},loadFont:{type:Function,default:function(t,n,i,r){return document.fonts.load([n,i,"1px",t].join(" "),r)}},createWorker:{type:Function,default:function(t){return new Worker(URL.createObjectURL(new Blob([t])))}}};var a={separateAnimationDelay:function(){var t=this.animationDuration,n=this.cloudWords,i=this.separateAnimationDuration;return n.length>1?(t-i)/(n.length-1):0},separateAnimationDuration:function(){var t=this.animationDuration,n=this.cloudWords;return n.length>0?t/Math.min(4,n.length):0},transitionHooks:function(){var t=this.animationDuration,n=function(t){t.style.opacity=0,t.style.transform="scale3d(0.3, 0.3, 0.3)"};return{beforeEnter:n,enter:function(n,i){setTimeout(function(){n.style.opacity=null,n.style.transform=null,setTimeout(i,t)},1)},leave:function(i,r){n(i),setTimeout(r,t)}}}};function f(n){return t(n)?n:function(t){return function(){return t}}(n)}function s(t){return void 0===t}function c(t,n){return t.postMessage(n),function(t){return new Promise(function(n,i){var r,e=function(t){var i=t.data;r(),n(i)},o=function(t){var n=t.error;r(),i(n)};r=function(){t.removeEventListener("message",e),t.removeEventListener("error",o)},t.addEventListener("message",e),t.addEventListener("error",o)})}(t)}function h(t,n,i){return Math.ceil(t*Math.abs(Math.sin(i))+n*Math.abs(Math.cos(i)))}function l(t,n,i){return Math.ceil(t*Math.abs(Math.cos(i))+n*Math.abs(Math.sin(i)))}function d(t,n,i,r,e){return[t,n,i,r+"px",e].join(" ")}function v(t,n){return Math.ceil(t/n)*n}function m(t,n,i){var r=i().getContext("2d");return r.font=n,r.measureText(t).width}var p=4;var g=function(t,n,i,r,e,o,u){this.t=t,this.n=n,this.i=i,this.r=r,this.e=e,this.o=o,this.u=u,this.a=1,this.f=0,this.s=0,this.c=0},b={h:{configurable:!0},l:{configurable:!0},d:{configurable:!0},v:{configurable:!0},m:{configurable:!0},p:{configurable:!0},g:{configurable:!0},b:{configurable:!0},y:{configurable:!0},M:{configurable:!0},w:{configurable:!0},x:{configurable:!0},F:{configurable:!0},S:{configurable:!0},W:{configurable:!0},B:{configurable:!0},k:{configurable:!0},j:{configurable:!0},P:{configurable:!0}};b.h.get=function(){return this.a},b.h.set=function(t){this.a!==t&&(this.a=t,this.T=void 0)},b.l.get=function(){return d(this.r,this.e,this.o,this.h,this.i)},b.d.get=function(){return void 0===this.L&&(this.L=m(this.t,d(this.r,this.e,this.o,1,this.i),this.u)),this.L},b.v.get=function(){return this.d*this.h},b.m.get=function(){return this.s*this.h},b.m.set=function(t){this.s=t/this.h},b.p.get=function(){return this.c*this.h},b.p.set=function(t){this.c=t/this.h},b.g.get=function(){return l(this.v,this.h,this.n)},b.b.get=function(){return h(this.v,this.h,this.n)},b.y.get=function(){return this.m-this.g/2},b.M.get=function(){return this.p-this.b/2},b.w.get=function(){return this.f},b.w.set=function(t){this.f!==t&&(this.f=t,this.T=void 0)},b.x.get=function(){return void 0===this.T&&(this.T=function(t,n,i,r,e,o,u,a,f){var s=d(n,i,r,e*=p,o),c=m(t,s,f),g=u*e*2,b=f(),y=b.getContext("2d"),M=v(l(g+2*e+c,g+3*e,a),p),w=v(h(g+2*e+c,g+3*e,a),p);b.width=M,b.height=w,y.translate(M/2,w/2),y.rotate(a),y.font=s,y.textAlign="center",y.textBaseline="middle",y.fillText(t,0,0),g>0&&(y.miterLimit=1,y.lineWidth=g,y.strokeText(t,0,0));for(var x=y.getImageData(0,0,M,w).data,F=[],S=1/0,W=0,B=1/0,k=0,j=M/p,E=w/p,P=0;P<j;++P)for(var T=0;T<E;++T)t:for(var L=0;L<p;++L)for(var N=0;N<p;++N)if(x[4*(M*(T*p+N)+(P*p+L))+3]){F.push([P,T]),S=Math.min(P,S),W=Math.max(P+1,W),B=Math.min(T,B),k=Math.max(T+1,k);break t}return F.length>0?[F.map(function(t){var n=t[0],i=t[1];return[n-S,i-B]}),W-S,k-B,Math.ceil(j/2)-S,Math.ceil(E/2)-B]:[F,0,0,0,0]}(this.t,this.r,this.e,this.o,this.h,this.i,this.w,this.n,this.u)),this.T},b.F.get=function(){return this.x[0]},b.S.get=function(){return this.x[1]},b.W.get=function(){return this.x[2]},b.B.get=function(){return this.x[3]},b.k.get=function(){return this.x[4]},b.j.get=function(){return Math.ceil(this.m)-this.B},b.j.set=function(t){this.m=t+this.B},b.P.get=function(){return Math.ceil(this.p)-this.k},b.P.set=function(t){this.p=t+this.k},Object.defineProperties(g.prototype,b);var y={cloudWords:function(t){this.$emit("update:cloudWords",t)},progress:{handler:function(t){this.$emit("update:progress",t)},deep:!0,immediate:!0}};var M={defaultScopedSlot:function(t){return t.text},detectElementResize:function(){this.elementWidth=this.$el.offsetWidth,this.elementHeight=this.$el.offsetHeight},startElementResizeDetector:function(){var t=this;requestAnimationFrame(function(){t._isDestroyed||(setTimeout(function(){t.startElementResizeDetector()},1e3),t.detectElementResize())})}},w="div";var x={name:"VueWordCloud",mixins:[function(o){return{data:function(){var t={};return Object.keys(o).forEach(function(n){t[e+n]={}}),t},computed:{},beforeCreate:function(){var u=this,a=new Set;Object.entries(o).forEach(function(o){var f=o[0],s=o[1],c=s.get,h=s.default,l=s.errorHandler;void 0===l&&(l=n);var d,v=!0;u.$options.computed[f]=function(){return this[e+f],this[r+f],h},u.$options.computed[r+f]=function(){var n=this;d&&(d.interrupt(),a.delete(d)),v&&(v=!1,t(h)&&(h=h.call(this)));var r=new i(h);d=r,a.add(d),new Promise(function(t){t(c.call(n,r))}).then(function(t){r.throwIfInterrupted(),h=t,n[e+f]={}}).catch(l)}})}}}({cloudWords:{get:function(t){var i,r=this,e=this,o=e.elementWidth,u=e.elementHeight,a=e.words,h=e.text,l=e.weight,d=e.rotation,v=e.rotationUnit,m=e.fontFamily,p=e.fontStyle,b=e.fontVariant,y=e.fontWeight,M=e.color,w=e.spacing,x=e.fontSizeRatio,F=e.createCanvas,S=e.loadFont,W=e.createWorker;i=x,x=(i=Math.abs(i))>1?1/i:i;var B=function(t){var n=t[0],i=t[1];return n>i?[1,i/n]:i>n?[n/i,1]:[1,1]}([o,u]);if(o>0&&u>0){var k=f(h),j=f(l),E=f(d),P=f(v),T=f(m),L=f(p),N=f(b),A=f(y),O=f(M);return a=a.map(function(t,n){var i,r,e,o,u,f,c,h,l,d,v;t&&("string"==typeof t?e=t:Array.isArray(t)?(e=(i=t)[0],o=i[1]):function(t){return t&&"object"==typeof t}(t)&&(e=(r=t).text,o=r.weight,u=r.rotation,f=r.rotationUnit,c=r.fontFamily,h=r.fontStyle,l=r.fontVariant,d=r.fontWeight,v=r.color)),s(e)&&(e=k(t,n,a)),s(o)&&(o=j(t,n,a)),s(u)&&(u=E(t,n,a)),s(f)&&(f=P(t,n,a)),s(c)&&(c=T(t,n,a)),s(h)&&(h=L(t,n,a)),s(l)&&(l=N(t,n,a)),s(d)&&(d=A(t,n,a)),s(v)&&(v=O(t,n,a));var m=new g(e,function(){switch(f){case"turn":return u*Math.PI*2;case"deg":return function(t){return t*Math.PI/180}(u)}return u}(),c,h,l,d,F);return Object.assign(m,{N:t,A:o,O:v}),m}),Promise.resolve().then(function(){return Promise.all(a.map(function(t){var n=t.i,i=t.r,r=t.o,e=t.t;return S(n,i,r,e)}))}).catch(n).then(function(){if((a=a.filter(function(t){return t.v>0}).sort(function(t,n){return n.A-t.A})).length>0){var n=a[0],i=function(t){return t[t.length-1]}(a),e=n.A,f=i.A;if(f<e){var s=x>0?1/x:f>0?e/f:e<0?f/e:1+e-f;a.forEach(function(t){var n,i,r;t.h=(n=t.A,(r=1)+(n-(i=f))*(s-r)/(e-i))})}a.reduceRight(function(t,n){return n.h<2*t?n.h/=t:(t=n.h,n.h=1),n.z=t},1),a.forEach(function(t){t.h*=4});var h=W('!function(){"use strict";var r=function(t){self.removeEventListener("message",r);var n,f,a,u,e,i=t.data,o=function(){n={},f=0,a=0,u=0,e=0};o();var v=function(){return Math.ceil((f+a)/2)},c=function(){return Math.ceil((u+e)/2)},s=function(){return{left:v(),top:c(),width:a-f,height:e-u}},h=function(r,t,f){return function(r,t,n){var f,a,u=r[0],e=r[1],i=t[0],o=t[1];u>e?(f=1,a=e/u):e>u?(a=1,f=u/e):f=a=1;var v=[i,o];if(n(v))return v;for(var c=i,s=o,h=i,M=o,l=c,g=s;;){i-=f,o-=a,c+=f,s+=a;var d=Math.floor(i),m=Math.floor(o),p=Math.ceil(c),w=Math.ceil(s);if(p>l)for(var B=m;B<w;++B){var F=[p,B];if(n(F))return F}if(w>g)for(var b=p;b>d;--b){var j=[b,w];if(n(j))return j}if(d<h)for(var k=w;k>m;--k){var q=[d,k];if(n(q))return q}if(m<M)for(var x=d;x<p;++x){var y=[x,m];if(n(y))return y}h=d,M=m,l=p,g=w}}(i,[t+v(),f+c()],function(t){var f=t[0],a=t[1];return function(r,t,f){return r.every(function(r){var a=r[0],u=r[1];return!n[t+a+"|"+(f+u)]})}(r,f,a)})};self.postMessage({}),self.addEventListener("message",function(r){self.postMessage({getBounds:s,put:function(r,t,i){r.forEach(function(r){var o=r[0],v=r[1],c=t+o,s=i+v;n[c+"|"+s]=!0,f=Math.min(c,f),a=Math.max(c+1,a),u=Math.min(s,u),e=Math.max(s+1,e)})},findFit:h,clear:o}[r.data.name].apply(null,r.data.args))})};self.addEventListener("message",r)}();\n'),l={completedWords:0,totalWords:a.length};return Promise.resolve().then(function(){return t.throwIfInterrupted(),r.progress=l,c(h,B)}).then(function(){t.throwIfInterrupted(),l.completedWords++;var n=Promise.resolve();return a.reduce(function(i,r,e){return n=n.then(function(){return r.z<i.z?Promise.resolve().then(function(){return c(h,{name:"clear"})}).then(function(){var t=Promise.resolve(),n=i.z/r.z;return a.slice(0,e).forEach(function(i){t=t.then(function(){return i.h*=n,c(h,{name:"put",args:[i.F,i.j,i.P]})})}),t}):c(h,{name:"put",args:[i.F,i.j,i.P]})}).then(function(){return r.w=w,c(h,{name:"findFit",args:[r.F,r.j,r.P]})}).then(function(n){var i=n[0],e=n[1];t.throwIfInterrupted(),l.completedWords++,r.j=i,r.P=e,r.w=0}),r}),n}).then(function(){return c(h,{name:"put",args:[i.F,i.j,i.P]})}).then(function(){return c(h,{name:"getBounds"})}).then(function(t){var n=t.left,i=t.top,r=t.width,e=t.height;if(r>0&&e>0){var f=Math.min(o/r,u/e);a.forEach(function(t){t.m-=n,t.p-=i,t.h*=f})}var s=new Set;return a.map(function(t){for(var n=t.N,i=t.t,r=t.A,e=t.n,o=t.l,u=t.m,a=t.p,f=t.O,c=JSON.stringify([i,m,p,b,y]);s.has(c);)c+="!";return s.add(c),{key:c,word:n,text:i,weight:r,rotation:e,font:o,color:f,left:u,top:a}})}).finally(function(){h.terminate()}).finally(function(){t.throwIfInterrupted(),r.progress=null})}return[]})}return[]},default:o}})],props:u,data:function(){return{elementWidth:0,elementHeight:0,progress:null}},computed:a,watch:y,mounted:function(){this.startElementResizeDetector()},methods:M,render:function(t){var n=this.$scopedSlots,i=this.animationDuration,r=this.animationEasing,e=this.cloudWords,o=this.defaultScopedSlot,u=this.separateAnimationDelay,a=this.separateAnimationDuration,f=this.transitionHooks;n=Object.assign({},{default:o},n);var s=e.map(function(e,o){var s=e.word,c=e.key,h=e.text,l=e.weight,d=e.rotation,v=e.font,m=e.color,p=e.left,g=e.top,b=n.default({word:s,text:h,weight:l,font:v,color:m,left:p,top:g}),y={position:"absolute",left:"50%",top:"50%",color:m,font:v,whiteSpace:"nowrap",transform:["translate(-50%, -50%)","rotate("+d+"rad)"].join(" ")},M={position:"absolute",left:p+"px",top:g+"px"};if(i>0){var x=["all",a+"ms",r,u*o+"ms"].join(" ");y.transition=x,M.transition=x}var F=t(w,{style:y},[b]),S=t(w,{key:c,style:M},[F]);return t("transition",{props:{css:!1},on:f},[S])}),c=t(w,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},s);return t(w,{style:{position:"relative",width:"100%",height:"100%"}},[c])}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(x.name,x),x});
