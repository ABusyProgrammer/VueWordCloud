!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";function t(t){return function(){return t}}function e(t){return"function"==typeof t}function n(){return[]}function r(t){return t&&"object"==typeof t}function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(t){return Math.pow(2,Math.ceil(function(t){return Math.log(t)/Math.LN2}(t)))}function a(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})}function f(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})}function u(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function c(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]}function h(t){return 2*t*Math.PI}function s(t,e,n,r,i){if(n>0&&r>0&&e.length>0){var s=n/r,d=function(t,e){var n={};if(t.length>0){var r=a(t,function(t){return t.weight}),i=f(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=u(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=u(a,r,i,1,o)})}}return n}(e,i);e=e.map(function(t){var e=t.key,n=t.text,r=t.rotation,i=t.fontFamily,a=t.fontStyle,f=t.fontVariant,u=t.fontWeight,s=Math.pow(v-1,2)*d[e]+1,l=function(t,e,n,r,i,o,a){a=h(a);var f=[e,n,r,i+"px",o].join(" "),u=document.createElement("canvas").getContext("2d");u.font=f;var s=u.measureText(t).width,d=i,l=c(s,d,a),v=l[0],g=l[1],p=Math.max(u.measureText("m").width,i),m=c(s+2*p,d+2*p,a);return[s,d,v,g,m[0],m[1]]}(n,a,f,u,s,i,r),g=l[0],p=l[1],m=l[2],y=l[3],w=l[4],W=l[5],M=o(w),S=o(W),b=function(t,e,n,r,i,o,a,f,u){u=h(u);var c=[e,n,r,i+"px",o].join(" "),s=document.createElement("canvas").getContext("2d");s.canvas.width=a,s.canvas.height=f,s.translate(a/2,f/2),s.rotate(u),s.font=c,s.shadowColor="#000000",s.shadowBlur=i/32,s.textAlign="center",s.textBaseline="middle",s.fillText(t,0,0);for(var d=new Uint8Array(a*f),l=s.getImageData(0,0,a,f).data,v=0,g=d.length;v<g;++v)d[v]=l[4*v+3];return d}(n,a,f,u,s,i,M,S,r);return Object.assign({fontSize:s,textWidth:g,textHeight:p,rectWidth:m,rectHeight:y,image:b,imageWidth:M,imageHeight:S},t)});var g=new Worker(l),p=function(){g.terminate()};t.onInterrupt(p),g.postMessage({words:e.map(function(t){return{key:t.key,rectWidth:t.rectWidth,rectHeight:t.rectHeight,image:t.image,imageWidth:t.imageWidth,imageHeight:t.imageHeight}}),containerAspect:s,fontSizePower:v});var m=function(t){return new Promise(function(e,n){var r,i=function(t){r(t),e(t.data)},o=function(t){r(t),n(t)};r=function(e){e.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",o)},t.addEventListener("message",i),t.addEventListener("error",o)})}(g).then(function(t){var n={};return e.forEach(function(t){var e=t.key;n[e]=t}),t.forEach(function(t){var e=t.key;Object.assign(n[e],t)}),e});return m.then(p,p),m}return[]}var d=function(){this.interrupted=!1,this.interruptHandlers=new Set};d.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},d.prototype.interrupt=function(){this.interrupted||(this.interrupted=!1,this.interruptHandlers.forEach(function(t){t()}))},d.prototype.onInterrupt=function(t){this.interrupted&&(this.interruptHandlers.has(t)||t()),this.interruptHandlers.add(t)};var l=URL.createObjectURL(new Blob(['!function(){"use strict";function r(r,t,a,n,e,f){var o=function(r,t,a){for(var n=[],e=0;e<t;++e)for(var f=0;f<a;++f)r[t*f+e]&&n.push([e,f]);return n}(n,e,f);return function(r,t,a){if(r>0&&t>0){var n,e;r>t?(n=1,e=t/r):t>r?(e=1,n=r/t):n=e=1;var f=Math.floor(r/2),o=Math.floor(t/2),i=r-f,v=t-o;if(f<i)for(var u=f;u<=i;++u){var h=[u,o];if(a(h))return h}else if(o<v)for(var c=o;c<=v;++c){var g=[f,c];if(a(g))return g}for(var s=f,l=o,M=i,m=v;i<r||v<t;){f-=n,o-=e,i+=n,v+=e;var p=Math.floor(f),w=Math.floor(o),d=Math.ceil(i),y=Math.ceil(v);if(d>M)for(var A=w;A<y;++A){var P=[d,A];if(a(P))return P}if(y>m)for(var k=d;k>p;--k){var H=[k,y];if(a(H))return H}if(p<s)for(var L=y;L>w;--L){var U=[p,L];if(a(U))return U}if(w<l)for(var W=p;W<d;++W){var E=[W,w];if(a(E))return E}s=p,l=w,M=d,m=y}}}(t-e,a-f,function(a){for(var n=a[0],e=a[1],f=0,i=o.length;f<i;++f){var v=o[f],u=v[0],h=v[1];if(r[t*(h+e)+(u+n)])return!1}return!0})}function t(r,t,a,n){for(var e=t/n,f=a/n,o=new Uint8Array(e*f),i=0;i<e;++i)for(var v=0;v<f;++v)r:for(var u=0;u<n;++u)for(var h=0;h<n;++h){var c=r[t*(v*n+h)+(i*n+u)];if(c){o[e*v+i]=c;break r}}return[o,e,f]}function a(r,t,a,n,e,f,o,i){for(var v=0;v<o;++v)for(var u=0;u<i;++u){var h=f[o*u+v];if(h){r[t*(u+e)+(v+n)]=h}}}self.addEventListener("message",function(n){var e=n.data,f=e.words,o=e.containerAspect,i=e.fontSizePower;f.forEach(function(r){var t=r.imageWidth,a=r.imageHeight;r.imagePower=function(r){return Math.log(r)/Math.LN2}(Math.min(t,a)/Math.pow(i,2))});var v,u=(f=function(r,t){return r.map(function(r){return[t(r),r]}).sort(function(r,t){var a=r[0],n=t[0];return a>n?1:a<n?-1:0}).map(function(r){return r[1]})}(f,function(r){return-r.imagePower})).map(function(n){for(var e=n.key,f=n.rectWidth,i=n.rectHeight,u=n.image,h=n.imageWidth,c=n.imageHeight,g=n.imagePower,s=[[u,h,c]],l=1;l<g;++l){var M;u=(M=t(u,h,c,2))[0],h=M[1],c=M[2],s.push([u,h,c])}if(void 0===v){var m=Math.pow(2,16),p=Math.floor(Math.sqrt(o*m)),w=Math.floor(m/p),d=new Uint8Array(p*w);v=[[d,p,w]];for(var y=1;y<s.length;++y)p*=2,w*=2,d=new Uint8Array(p*w),v.unshift([d,p,w])}var A=v[s.length-1],P=A[0],k=A[1],H=A[2],L=r(P,k,H,u,h,c),U=L[0],W=L[1];a(P,k,0,U,W,u,h,c);for(var E=s.length-1;E-- >0;){U*=2,W*=2;var b;P=(b=v[E])[0],k=b[1],H=b[2];var q;a(P,k,0,U,W,u=(q=s[E])[0],h=q[1],c=q[2])}return{key:e,rectLeft:U+(h-f)/2,rectTop:W+(c-i)/2}});self.postMessage(u)})}();\n'])),v=4,g={boundedWords:{get:function(t){return s(t,this.populatedWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},default:n}},p={name:"VueWordCloud",props:{words:{type:Array,default:n},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){var t=this,n={containerWidth:0,containerHeight:0};return Object.entries(g).forEach(function(i){var o=i[0],a=i[1].default;e(a)&&(a=a.call(t)),r(a)&&(a=Object.freeze(a)),n["fulfilled$"+o]=a}),n},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,o,a,f,u,c,h){var s={};return t.forEach(function(t){var d,l,v,g,p,m,y,w,W;if(t)if(function(t){return"string"==typeof t}(t))l=t;else if(Array.isArray(t)){var M;l=(M=t)[0],v=M[1]}else if(r(t)){var S;d=(S=t).key,l=S.text,v=S.weight,g=S.rotation,p=S.fontFamily,m=S.fontStyle,y=S.fontVariant,w=S.fontWeight,W=S.color}for(void 0===l&&(l=e(t)),void 0===v&&(v=n(t)),void 0===g&&(g=o(t)),void 0===p&&(p=a(t)),void 0===m&&(m=f(t)),void 0===y&&(y=u(t)),void 0===w&&(w=c(t)),void 0===W&&(W=h(t)),void 0===d&&(d=JSON.stringify([l,p,m,y,w]));i(s,d);)d+="!";s[d]={originalWord:t,key:d,text:l,weight:v,rotation:g,fontFamily:p,fontStyle:m,fontVariant:y,fontWeight:w,color:W}}),s}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},populatedWords:function(){return Object.values(this.keyedPopulatedWords)},scaledBoundedWords:function(){return function(t,e,n,r){var i=a(t,function(t){return t.rectLeft}),o=f(t,function(t){return t.rectLeft+t.rectWidth}),u=o-i,c=a(t,function(t){return t.rectTop}),h=f(t,function(t){return t.rectTop+t.rectHeight}),s=h-c,d=Math.min(e/u,n/s),l=f(t,function(t){return t.fontSize})*d;return l>r&&(d*=r/l),t.map(function(t){var e=t.fontSize,n=t.textWidth,r=t.textHeight,a=t.rectLeft,f=t.rectTop,u=t.rectWidth,s=t.rectHeight;return e*=d,n*=d,r*=d,a=(a-(i+o)/2)*d,f=(f-(c+h)/2)*d,u*=d,s*=d,Object.assign({},t,{fontSize:e,textWidth:n,textHeight:r,rectLeft:a,rectTop:f,rectWidth:u,rectHeight:s})})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},beforeCreate:function(){var t=this;Object.entries(g).forEach(function(e){var n=e[0],i=e[1],o=i.errorHandler||function(){};t.$options.computed[n]=function(){var t=this;return Promise.resolve(this["promised$"+n]).then(function(e){r(e)&&(e=Object.freeze(e)),t["fulfilled$"+n]=e}).catch(o),this["fulfilled$"+n]};var a=new d;t.$options.computed["promised$"+n]=function(){var t=this;a.interrupt();var e=a=new d;return Promise.resolve(i.get.call(this,e)).then(function(n){if(t._isDestroyed)throw new Error;return e.throwIfInterrupted(),n})}})},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},n.map(function(n){var i=n.originalWord,o=n.key,a=n.text,f=n.weight,u=n.rotation,c=n.fontFamily,h=n.fontStyle,s=n.fontVariant,d=n.fontWeight,l=n.color,v=n.fontSize,g=(n.textWidth,n.textHeight,n.rectLeft),p=n.rectTop,m=n.rectWidth,y=n.rectHeight;return t("div",{key:o,style:{position:"absolute",top:p+y/2+"px",left:g+m/2+"px",transform:"rotate("+u+"turn)",color:l,transitionDuration:Math.round(r)+"ms",transitionProperty:"all",font:[h,s,d,v+"px/1",c].join(" ")}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[e.default({originalWord:i,text:a,weight:f,rotation:u,fontFamily:c,fontStyle:h,fontVariant:s,fontWeight:d,color:l,fontSize:v})])])}))])}(t,Object.assign({default:function(t){return t.text}},this.$scopedSlots),this.scaledBoundedWords,this.animationDuration)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(p.name,p),p});
