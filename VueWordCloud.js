!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";var t=function(t){return function(){return t}},e=function(t){return"function"==typeof t},n=function(t){return t&&"object"==typeof t},r=function(t,e){if(t===e)return!0;if(Array.isArray(t)){if(Array.isArray(e)&&t.length===e.length)return t.every(function(t,n){return r(t,e[n])})}else if(n(t)&&n(e)){var i=Object.entries(t);if(i.length===Object.keys(e).length)return i.every(function(t){var n=t[0],i=t[1];return r(i,e[n])})}return!1},i=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o=function(t){return function(t,e){var n={};return Object.entries(t).forEach(function(t){var r=t[0],i=t[1];n[r]=e(i,r)}),n}(t,function(t){return{key:t.key,text:t.text,weight:t.weight,rotation:t.rotation,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontVariant:t.fontVariant,fontWeight:t.fontWeight}})},a=function(t){return 2*t*Math.PI},f=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})},u=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})},c=function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},h=function(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]},d=function(t,e,n,r,i,o,a){var f=[e,n,r,i+"px",o].join(" "),u=document.createElement("canvas").getContext("2d");u.font=f;var c=u.measureText(t).width;if(c>0){var d=i,l=Math.max(u.measureText("m").width,i),s=c+2*l,g=d+2*l,y=h(c,d,a),v=y[0],p=y[1],m=h(s,g,a),W=m[0],S=m[1];u.canvas.width=W,u.canvas.height=S,u.translate(W/2,S/2),u.rotate(a),u.font=f,u.textAlign="center",u.textBaseline="middle",u.fillText(t,0,0);for(var x=new Uint8Array(W*S),w=u.getImageData(0,0,W,S).data,b=0,F=x.length;b<F;++b)x[b]=w[4*b+3];return[[c,d],[v,p],[x,W,S]]}return null},l=function(t,e){for(var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],f=e[2],u=[],c=0;c<a;++c)for(var h=0;h<f;++h){o[a*h+c]&&u.push([c,h])}return function(t,e,n){if(t>0&&e>0){var r,i;t>e?(r=1,i=e/t):e>t?(i=1,r=t/e):r=i=1;var o=Math.floor(t/2),a=Math.floor(e/2),f=t-o,u=e-a;if(o<f)for(var c=o;c<=f;++c){var h=[c,a];if(n(h))return h}else if(a<u)for(var d=a;d<=u;++d){var l=[o,d];if(n(l))return l}for(var s=o,g=a,y=f,v=u;f<t||u<e;){o-=r,a-=i,f+=r,u+=i;var p=Math.floor(o),m=Math.floor(a),W=Math.ceil(f),S=Math.ceil(u);if(W>y)for(var x=m;x<S;++x){var w=[W,x];if(n(w))return w}if(S>v)for(var b=W;b>p;--b){var F=[b,S];if(n(F))return F}if(p<s)for(var M=S;M>m;--M){var k=[p,M];if(n(k))return k}if(m<g)for(var z=p;z<W;++z){var T=[z,m];if(n(T))return T}s=p,g=m,y=W,v=S}}}(r-a,i-f,function(t){for(var e=t[0],i=t[1],o=0,a=u.length;o<a;++o){var f=u[o],c=f[0],h=f[1];if(n[r*(h+i)+(c+e)])return!1}return!0})},s=function(t,e){for(var n=t[0],r=t[1],i=(t[2],e[0]),o=e[1],a=e[2],f=e[3],u=e[4],c=0;c<f;++c)for(var h=0;h<u;++h){var d=i[f*h+c];if(d){n[r*(h+a)+(c+o)]=d}}},g=function(t,e,n,r){var i=[];if(t.length>0&&e>0&&n>0){var o=e/n,h=function(t,e){var n={};if(t.length>0){var r=f(t,function(t){return t.weight}),i=u(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=c(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=c(a,r,i,1,o)})}}return n}(t,r),g=(t=function(t,e){return t.map(function(t){return[e(t),t]}).sort(function(t,e){var n=t[0],r=e[0];return n>r?1:n<r?-1:0}).map(function(t){return t[1]})}(t,function(t){var e=t.key;return-h[e]})).shift(),y=g.key,v=g.text,p=g.rotation,m=g.fontFamily,W=g.fontStyle,S=g.fontVariant,x=g.fontWeight,w=4*h[y],b=a(p),F=d(v,W,S,x,w,m,b),M=F[0],k=M[0],z=M[1],T=F[1],V=T[0],H=T[1],C=F[2],B=C[0],A=C[1],j=C[2],O=Math.pow(2,22),E=Math.floor(Math.sqrt(o*O)),L=Math.floor(O/E),U=new Uint8Array(E*L),N=Math.floor((E-A)/2),P=Math.floor((L-j)/2);s([U,E,L],[B,N,P,A,j]);var R=N+(A-V)/2,$=P+(j-H)/2;i.push({key:y,fontSize:w,textWidth:k,textHeight:z,rectLeft:R,rectTop:$,rectWidth:V,rectHeight:H}),t.forEach(function(t){var e=t.key,n=t.text,r=t.rotation,o=t.fontFamily,f=t.fontStyle,u=t.fontVariant,c=t.fontWeight,g=4*h[e],y=a(r),v=d(n,f,u,c,g,o,y),p=v[0],m=p[0],W=p[1],S=v[1],x=S[0],w=S[1],b=v[2],F=b[0],M=b[1],k=b[2],z=l([U,E,L],[F,M,k]),T=z[0],V=z[1];s([U,E,L],[F,T,V,M,k]);var H=T+(M-x)/2,C=V+(k-w)/2;i.push({key:e,fontSize:g,textWidth:m,textHeight:W,rectLeft:H,rectTop:C,rectWidth:x,rectHeight:w})})}return i},y={name:"VueWordCloud",render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%"}},e.map(function(e){var i=e.key,o=e.fontSize,a=(e.textWidth,e.textHeight,e.rectLeft),f=e.rectTop,u=e.rectWidth,c=e.rectHeight,h=n[i],d=h.originalWord,l=h.text,s=h.weight,g=h.rotation,y=h.fontFamily,v=h.fontStyle,p=h.fontVariant,m=h.fontWeight,W=h.color;return t("div",{key:i,style:{position:"absolute",left:a+u/2+"px",top:f+c/2+"px",transform:"rotate("+g+"turn)"}},[t("div",{style:{position:"absolute",left:"50%",top:"50%",color:W,font:[v,p,m,o+"px/1",y].join(" "),whiteSpace:"nowrap",transform:"translate(-50%, -50%)"}},[r({originalWord:d,text:l,weight:s,rotation:g,fontFamily:y,fontStyle:v,fontVariant:p,fontWeight:m,color:W,fontSize:o})])])}))}(t,this.scaledBoundedWords,this.keyedPopulatedWords,this.$scopedSlots.default?this.$scopedSlots.default:function(t){return t.text})},props:{words:{type:Array,default:function(){return[]}},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){return{containerWidth:0,containerHeight:0,keyedBoundableWords:void 0}},mounted:function(){this.startToUpdateContainerSize()},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,r,o,a,f,u,c,h){var d={};return t.forEach(function(t){var l,s,g,y,v,p,m,W,S;if(t)if("string"==typeof t)s=t;else if(Array.isArray(t)){var x;s=(x=t)[0],g=x[1]}else if(n(t)){var w;l=(w=t).key,s=w.text,g=w.weight,y=w.rotation,v=w.fontFamily,p=w.fontStyle,m=w.fontVariant,W=w.fontWeight,S=w.color}for(void 0===s&&(s=e(t)),void 0===g&&(g=r(t)),void 0===y&&(y=o(t)),void 0===v&&(v=a(t)),void 0===p&&(p=f(t)),void 0===m&&(m=u(t)),void 0===W&&(W=c(t)),void 0===S&&(S=h(t)),void 0===l&&(l=JSON.stringify([s,v,p,m,W]));i(d,l);)l+="!";d[l]={key:l,originalWord:t,text:s,weight:g,rotation:y,fontFamily:v,fontStyle:p,fontVariant:m,fontWeight:W,color:S}}),d}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},watch$keyedBoundableWords:function(){return o(this.keyedPopulatedWords)},boundableWords:function(){return Object.values(this.keyedBoundableWords)},boundedWords:function(){return g(this.boundableWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},scaledBoundedWords:function(){return function(t,e,n,r){var i=f(t,function(t){return t.rectLeft}),o=u(t,function(t){return t.rectLeft+t.rectWidth}),a=o-i,c=f(t,function(t){return t.rectTop}),h=u(t,function(t){return t.rectTop+t.rectHeight}),d=h-c,l=Math.min(e/a,n/d),s=u(t,function(t){return t.fontSize})*l;return s>r&&(l*=r/s),t.map(function(t){var r=t.key,a=t.fontSize,f=t.textWidth,u=t.textHeight,d=t.rectLeft,s=t.rectTop,g=t.rectWidth,y=t.rectHeight;return a*=l,f*=l,u*=l,d=(d-(i+o)/2)*l+e/2,s=(s-(c+h)/2)*l+n/2,g*=l,y*=l,{key:r,fontSize:a,textWidth:f,textHeight:u,rectLeft:d,rectTop:s,rectWidth:g,rectHeight:y}})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},watch:{watch$keyedBoundableWords:{handler:function(t,e){r(t,e)||(this.keyedBoundableWords=Object.freeze(t))},immediate:!0}},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(y.name,y),y});
