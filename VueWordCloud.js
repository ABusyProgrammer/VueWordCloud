!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueWordCloud=e()}(this,function(){"use strict";function t(t){return function(){return t}}function e(t){return"function"==typeof t}function n(){return[]}function r(t){return t&&"object"==typeof t}function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(t){return Math.pow(2,Math.ceil(function(t){return Math.log(t)/Math.LN2}(t)))}function a(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})}function u(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})}function f(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function c(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]}function h(t){return 2*t*Math.PI}function s(t,e,n,r,i,o,a){return Promise.resolve().then(function(){a=h(a);var u=[e,n,r,i+"px",o].join(" ");return Promise.resolve().then(function(){return function(t,e){return document.fonts.load(t,e)}(u,t)}).then(function(){var e=document.createElement("canvas").getContext("2d");e.font=u;var n=e.measureText(t).width,r=i,o=c(n,r,a),f=o[0],h=o[1],s=Math.max(e.measureText("m").width,i),d=c(n+2*s,r+2*s,a);return[n,r,f,h,d[0],d[1]]})})}function d(t,e,n,r){return Promise.resolve().then(function(){var t=function(t,e){var n={};if(t.length>0){var r=a(t,function(t){return t.weight}),i=u(t,function(t){return t.weight});if(r<i&&e>0&&e<1/0)e<1&&(e=1/e),t.forEach(function(t){var o=t.key,a=t.weight;n[o]=f(a,r,i,1,e)});else if(r>0)t.forEach(function(t){var e=t.key,i=t.weight;n[e]=i/r});else{var o=1+Math.abs(r)+Math.abs(i);t.forEach(function(t){var e=t.key,a=t.weight;n[e]=f(a,r,i,1,o)})}}return n}(e,r);return Promise.all(e.map(function(e){var r=e.key,i=e.text,a=e.rotation,u=e.fontFamily,f=e.fontStyle,c=e.fontVariant,d=e.fontWeight,l=Math.pow(n-1,2)*t[r]+1;return Promise.resolve().then(function(){return s(i,f,c,d,l,u,a)}).then(function(t){var n=t[0],r=t[1],s=t[2],v=t[3],g=t[4],p=t[5],m=o(g),y=o(p),w=function(t,e,n,r,i,o,a,u,f){f=h(f);var c=[e,n,r,i+"px",o].join(" "),s=document.createElement("canvas").getContext("2d");s.canvas.width=a,s.canvas.height=u,s.translate(a/2,u/2),s.rotate(f),s.font=c,s.shadowColor="#000000",s.shadowBlur=i/32,s.textAlign="center",s.textBaseline="middle",s.fillText(t,0,0);for(var d=new Uint8Array(a*u),l=s.getImageData(0,0,a,u).data,v=0,g=d.length;v<g;++v)d[v]=l[4*v+3];return d}(i,f,c,d,l,u,m,y,a);return Object.assign({fontSize:l,textWidth:n,textHeight:r,rectWidth:s,rectHeight:v,image:w,imageWidth:m,imageHeight:y},e)})}))})}function l(t,e,n,r,i){var o=new Worker(g),a=function(){o.terminate()};t.onInterrupt(a),o.postMessage({words:e,fontSizePower:n,containerWidth:r,containerHeight:i});var u=function(t){return new Promise(function(e,n){var r,i=function(t){r(t),e(t.data)},o=function(t){r(t),n(t)};r=function(e){e.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",o)},t.addEventListener("message",i),t.addEventListener("error",o)})}(o);return u.then(a,a),u}var v=function(){this.interrupted=!1,this.interruptHandlers=new Set};v.prototype.throwIfInterrupted=function(){if(this.interrupted)throw new Error},v.prototype.interrupt=function(){this.interrupted||(this.interrupted=!1,this.interruptHandlers.forEach(function(t){t()}))},v.prototype.onInterrupt=function(t){this.interrupted&&(this.interruptHandlers.has(t)||t()),this.interruptHandlers.add(t)};var g=URL.createObjectURL(new Blob(['!function(){"use strict";function r(r,t,n,a,e,i){var o=function(r,t,n){for(var a=[],e=0;e<t;++e)for(var i=0;i<n;++i)r[t*i+e]&&a.push([e,i]);return a}(a,e,i);return function(r,t,n){if(r>0&&t>0){var a,e;r>t?(a=1,e=t/r):t>r?(e=1,a=r/t):a=e=1;var i=Math.floor(r/2),o=Math.floor(t/2),f=r-i,v=t-o;if(i<f)for(var u=i;u<=f;++u){var h=[u,o];if(n(h))return h}else if(o<v)for(var c=o;c<=v;++c){var g=[i,c];if(n(g))return g}for(var l=i,s=o,M=f,d=v;f<r||v<t;){i-=a,o-=e,f+=a,v+=e;var m=Math.floor(i),p=Math.floor(o),W=Math.ceil(f),w=Math.ceil(v);if(W>M)for(var y=p;y<w;++y){var H=[W,y];if(n(H))return H}if(w>d)for(var x=W;x>m;--x){var S=[x,w];if(n(S))return S}if(m<l)for(var k=w;k>p;--k){var z=[m,k];if(n(z))return z}if(p<s)for(var A=m;A<W;++A){var L=[A,p];if(n(L))return L}l=m,s=p,M=W,d=w}}}(t-e,n-i,function(n){for(var a=n[0],e=n[1],i=0,f=o.length;i<f;++i){var v=o[i],u=v[0],h=v[1];if(r[t*(h+e)+(u+a)])return!1}return!0})}function t(r,t,n,a){for(var e=t/a,i=n/a,o=new Uint8Array(e*i),f=0;f<e;++f)for(var v=0;v<i;++v)r:for(var u=0;u<a;++u)for(var h=0;h<a;++h){var c=r[t*(v*a+h)+(f*a+u)];if(c){o[e*v+f]=c;break r}}return[o,e,i]}function n(r,t,n,a,e,i,o,f){for(var v=0;v<o;++v)for(var u=0;u<f;++u){var h=i[o*u+v];if(h){r[t*(u+e)+(v+a)]=h}}}var a=function(a,e,i,o){if(i>0&&o>0){var f,v=i/o;return a=a.map(function(r){var t=r.imageWidth,n=r.imageHeight;return[function(r){return Math.log(r)/Math.LN2}(Math.min(t,n)/Math.pow(e,2)),r]}),a=function(r,t){return r.map(function(r){return[t(r),r]}).sort(function(r,t){var n=r[0],a=t[0];return n>a?1:n<a?-1:0}).map(function(r){return r[1]})}(a,function(r){return-r[0]}),a=a.map(function(a){for(var e=a[0],i=a[1],o=(i.originalWord,i.key),u=i.text,h=i.weight,c=i.rotation,g=i.fontFamily,l=i.fontStyle,s=i.fontVariant,M=i.fontWeight,d=i.color,m=i.fontSize,p=i.textWidth,W=i.textHeight,w=i.rectWidth,y=i.rectHeight,H=i.image,x=i.imageWidth,S=i.imageHeight,k=[[H,x,S]],z=1;z<e;++z){var A;H=(A=t(H,x,S,2))[0],x=A[1],S=A[2],k.push([H,x,S])}if(void 0===f){var L=Math.pow(2,16),U=Math.floor(Math.sqrt(v*L)),F=Math.floor(L/U),V=new Uint8Array(U*F);f=[[V,U,F]];for(var b=1;b<k.length;++b)U*=2,F*=2,V=new Uint8Array(U*F),f.unshift([V,U,F])}var q=f[k.length-1],E=q[0],N=q[1],P=q[2],T=r(E,N,P,H,x,S),j=T[0],B=T[1];n(E,N,0,j,B,H,x,S);for(var C=k.length-1;C-- >0;){j*=2,B*=2;var D;E=(D=f[C])[0],N=D[1],P=D[2];var G;n(E,N,0,j,B,H=(G=k[C])[0],x=G[1],S=G[2])}return{key:o,text:u,weight:h,rotation:c,fontFamily:g,fontStyle:l,fontVariant:s,fontWeight:M,color:d,fontSize:m,textWidth:p,textHeight:W,rectLeft:j+(x-w)/2,rectTop:B+(S-y)/2,rectWidth:w,rectHeight:y}})}return[]};self.addEventListener("message",function(r){var t=r.data,n=t.words,e=t.fontSizePower,i=t.containerWidth,o=t.containerHeight;self.postMessage(a(n,e,i,o))})}();\n'])),p={measuredWords:{get:function(t){return d(0,this.populatedWords,4,this.fontSizeRatio)},default:n},boundedWords:{get:function(t){return l(t,this.measuredWords,4,this.containerWidth,this.containerHeight)},default:n}},m={name:"VueWordCloud",props:{words:{type:Array,default:n},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},animationDuration:{type:Number,default:5e3},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){var t=this,n={containerWidth:0,containerHeight:0};return Object.entries(p).forEach(function(i){var o=i[0],a=i[1].default;e(a)&&(a=a.call(t)),r(a)&&(a=Object.freeze(a)),n["fulfilled$"+o]=a}),n},computed:{getText:function(){var n=this.text;return e(n)?n:t(n)},getWeight:function(){var n=this.weight;return e(n)?n:t(n)},getRotation:function(){var n=this.rotation;return e(n)?n:t(n)},getFontFamily:function(){var n=this.fontFamily;return e(n)?n:t(n)},getFontStyle:function(){var n=this.fontStyle;return e(n)?n:t(n)},getFontVariant:function(){var n=this.fontVariant;return e(n)?n:t(n)},getFontWeight:function(){var n=this.fontWeight;return e(n)?n:t(n)},getColor:function(){var n=this.color;return e(n)?n:t(n)},keyedPopulatedWords:function(){return function(t,e,n,o,a,u,f,c,h){var s={};return t.forEach(function(t){var d,l,v,g,p,m,y,w,W;if(t)if(function(t){return"string"==typeof t}(t))l=t;else if(Array.isArray(t)){var x;l=(x=t)[0],v=x[1]}else if(r(t)){var S;d=(S=t).key,l=S.text,v=S.weight,g=S.rotation,p=S.fontFamily,m=S.fontStyle,y=S.fontVariant,w=S.fontWeight,W=S.color}for(void 0===l&&(l=e(t)),void 0===v&&(v=n(t)),void 0===g&&(g=o(t)),void 0===p&&(p=a(t)),void 0===m&&(m=u(t)),void 0===y&&(y=f(t)),void 0===w&&(w=c(t)),void 0===W&&(W=h(t)),void 0===d&&(d=JSON.stringify([l,p,m,y,w]));i(s,d);)d+="!";s[d]={originalWord:t,key:d,text:l,weight:v,rotation:g,fontFamily:p,fontStyle:m,fontVariant:y,fontWeight:w,color:W}}),s}(this.words,this.getText,this.getWeight,this.getRotation,this.getFontFamily,this.getFontStyle,this.getFontVariant,this.getFontWeight,this.getColor)},populatedWords:function(){return Object.values(this.keyedPopulatedWords)},scaledBoundedWords:function(){return function(t,e,n,r){var i=a(t,function(t){return t.rectLeft}),o=u(t,function(t){return t.rectLeft+t.rectWidth}),f=o-i,c=a(t,function(t){return t.rectTop}),h=u(t,function(t){return t.rectTop+t.rectHeight}),s=h-c,d=Math.min(e/f,n/s),l=u(t,function(t){return t.fontSize})*d;return l>r&&(d*=r/l),t.map(function(t){var e=t.fontSize,n=t.textWidth,r=t.textHeight,a=t.rectLeft,u=t.rectTop,f=t.rectWidth,s=t.rectHeight;return e*=d,n*=d,r*=d,a=(a-(i+o)/2)*d,u=(u-(c+h)/2)*d,f*=d,s*=d,Object.assign({},t,{fontSize:e,textWidth:n,textHeight:r,rectLeft:a,rectTop:u,rectWidth:f,rectHeight:s})})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},beforeCreate:function(){var t=this;Object.entries(p).forEach(function(e){var n=e[0],i=e[1],o=i.errorHandler||function(){};t.$options.computed[n]=function(){var t=this;return Promise.resolve(this["promised$"+n]).then(function(e){r(e)&&(e=Object.freeze(e)),t["fulfilled$"+n]=e}).catch(o),this["fulfilled$"+n]};var a=new v;t.$options.computed["promised$"+n]=function(){var t=this;a.interrupt();var e=a=new v;return Promise.resolve(i.get.call(this,e)).then(function(n){if(t._isDestroyed)throw new Error;return e.throwIfInterrupted(),n})}})},mounted:function(){this.startToUpdateContainerSize()},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}},render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},n.map(function(n){var i=n.originalWord,o=n.key,a=n.text,u=n.weight,f=n.rotation,c=n.fontFamily,h=n.fontStyle,s=n.fontVariant,d=n.fontWeight,l=n.color,v=n.fontSize,g=(n.textWidth,n.textHeight,n.rectLeft),p=n.rectTop,m=n.rectWidth,y=n.rectHeight;return t("div",{key:o,style:{position:"absolute",top:p+y/2+"px",left:g+m/2+"px",transform:"rotate("+f+"turn)",color:l,transitionDuration:Math.round(r)+"ms",transitionProperty:"all",font:[h,s,d,v+"px/1",c].join(" ")}},[t("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap"}},[e.default({originalWord:i,text:a,weight:u,rotation:f,fontFamily:c,fontStyle:h,fontVariant:s,fontWeight:d,color:l,fontSize:v})])])}))])}(t,Object.assign({default:function(t){return t.text}},this.$scopedSlots),this.scaledBoundedWords,this.animationDuration)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.component(m.name,m),m});
