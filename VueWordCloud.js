!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):t.VueWordCloud=e(t.Vue)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t){return function(){return t}},n=function(t){return"function"==typeof t},r=function(t){return t&&"object"==typeof t},o=function(t,e){if(t===e)return!0;if(Array.isArray(t)){if(Array.isArray(e)&&t.length===e.length)return t.every(function(t,n){return o(t,e[n])})}else if(r(t)&&r(e)){var n=Object.entries(t);if(n.length===Object.keys(e).length)return n.every(function(t){var n=t[0],r=t[1];return o(r,e[n])})}return!1},i=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a=function(t){return t[t.length-1]},u=function(t,e,n){return[Math.ceil(t*Math.abs(Math.cos(n))+e*Math.abs(Math.sin(n))),Math.ceil(t*Math.abs(Math.sin(n))+e*Math.abs(Math.cos(n)))]},f=function(t,e,n,r){var o=[];if(t.length>0&&e>0&&n>0){var i=e/n;t=function(t,e){return t.map(function(t){return[e(t),t]}).sort(function(t,e){var n=t[0],r=e[0];return n>r?1:n<r?-1:0}).map(function(t){return t[1]})}(t,function(t){return-t.weight});var f,c=a(t).weight,h=function(t){return t[0]}(t).weight;c<h&&r>0&&r<1/0?(r<1&&(r=1/r),f=function(t){return function(t,e,n,r,o){return r+(t-e)*(o-r)/(n-e)}(t,c,h,1,r)}):((t=function(t,e){for(var n=t.length;n-- >0&&!e(t[n],n););return t.slice(0,n+1)}(t,function(t){return t.weight>0})).length>0&&(c=a(t).weight),f=function(t){return t/c});var l=Math.pow(2,22),d=Math.floor(Math.sqrt(i*l)),s=Math.floor(l/d),p=Array(d*s).fill(0);t.forEach(function(t){var e=t.key,n=t.text,r=t.weight,i=t.rotation,a=t.fontFamily,c=t.fontStyle,h=t.fontVariant,l=t.fontWeight;t.color;try{var v=4*f(r),g=function(t){return 2*t*Math.PI}(i),y=[c,h,l,v+"px",a].join(" "),m=document.createElement("canvas").getContext("2d");m.font=y;var W=m.measureText(n).width;if(W>0){var S=v,x=Math.max(m.measureText("m").width,v),w=W+2*x,F=S+2*x,b=u(W,S,g),M=b[0],z=b[1],k=u(w,F,g),T=k[0],V=k[1],C=Array(T*V).fill(0);m.canvas.width=T,m.canvas.height=V,m.translate(T/2,V/2),m.rotate(g),m.font=y,m.textAlign="center",m.textBaseline="middle",m.fillText(n,0,0);for(var H=m.getImageData(0,0,T,V).data,A=0,j=C.length;A<j;++A)C[A]=H[4*A+3];for(var O=[],B=0;B<T;++B)for(var L=0;L<V;++L)C[T*L+B]&&O.push([B,L]);var P=function(t,e,n){if(t>0&&e>0){var r,o;t>e?(r=1,o=e/t):e>t?(o=1,r=t/e):r=o=1;var i=Math.floor(t/2),a=Math.floor(e/2),u=t-i,f=e-a;if(i<u)for(var c=i;c<=u;++c){var h=[c,a];if(n(h))return h}else if(a<f)for(var l=a;l<=f;++l){var d=[i,l];if(n(d))return d}for(var s=i,p=a,v=u,g=f;u<t||f<e;){i-=r,a-=o,u+=r,f+=o;var y=Math.floor(i),m=Math.floor(a),W=Math.ceil(u),S=Math.ceil(f);if(W>v)for(var x=m;x<S;++x){var w=[W,x];if(n(w))return w}if(S>g)for(var F=W;F>y;--F){var b=[F,S];if(n(b))return b}if(y<s)for(var M=S;M>m;--M){var z=[y,M];if(n(z))return z}if(m<p)for(var k=y;k<W;++k){var T=[k,m];if(n(T))return T}s=y,p=m,v=W,g=S}}throw new Error}(d-T,s-V,function(t){for(var e=t[0],n=t[1],r=0,o=O.length;r<o;++r){var i=O[r],a=i[0],u=i[1];if(a+=e,u+=n,p[d*u+a])return!1}for(var f=0,c=O.length;f<c;++f){var h=O[f],l=h[0],s=h[1];p[d*(s+=n)+(l+=e)]=1}return!0}),N=P[0]+(T-M)/2,R=P[1]+(V-z)/2;o.push({key:e,fontSize:v,textWidth:W,textHeight:S,rectLeft:N,rectTop:R,rectWidth:M,rectHeight:z})}}catch(t){}})}return o},c=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.min(t,e)})},h=function(t,e){if(t.length>0)return e&&(t=t.map(e)),t.reduce(function(t,e){return Math.max(t,e)})},l={name:"VueWordCloud",render:function(t){return function(t,e,n,r){return t("div",{style:{position:"relative",width:"100%",height:"100%"}},e.map(function(e){var o=e.key,i=e.fontSize,a=(e.textWidth,e.textHeight,e.rectLeft),u=e.rectTop,f=e.rectWidth,c=e.rectHeight,h=n[o],l=h.originalWord,d=h.text,s=h.weight,p=h.rotation,v=h.fontFamily,g=h.fontStyle,y=h.fontVariant,m=h.fontWeight,W=h.color;return t("div",{key:o,style:{position:"absolute",left:a+f/2+"px",top:u+c/2+"px",transform:"rotate("+p+"turn)"}},[t("div",{style:{position:"absolute",left:"50%",top:"50%",color:W,font:[g,y,m,i+"px/1",v].join(" "),whiteSpace:"nowrap",transform:"translate(-50%, -50%)"}},[r({originalWord:l,text:d,weight:s,rotation:p,fontFamily:v,fontStyle:g,fontVariant:y,fontWeight:m,color:W,fontSize:i})])])}))}(t,this.scaledBoundedWords,this.keyedPopulatedWords,this.$scopedSlots.default?this.$scopedSlots.default:function(t){return t.text})},props:{words:{type:Array,default:function(){return[]}},text:{type:[String,Function],default:""},weight:{type:[Number,Function],default:1},rotation:{type:[String,Function],default:function(){var t=[0,.75];return function(){return function(t){return t[Math.floor(t.length*Math.random())]}(t)}}},fontFamily:{type:[String,Function],default:"serif"},fontStyle:{type:[String,Function],default:"normal"},fontVariant:{type:[String,Function],default:"normal"},fontWeight:{type:[String,Function],default:"normal"},color:{type:[String,Function],default:"Black"},fontSizeRatio:{type:Number,default:0},maxFontSize:{type:Number,default:1/0},intervalBetweenUpdateContainerSize:{type:Number,default:1e3}},data:function(){return{containerWidth:0,containerHeight:0,boundableWords:void 0}},mounted:function(){this.startToUpdateContainerSize()},computed:{computeText:function(){var t=this.text;return n(t)?t:e(t)},computeWeight:function(){var t=this.weight;return n(t)?t:e(t)},computeRotation:function(){var t=this.rotation;return n(t)?t:e(t)},computeFontFamily:function(){var t=this.fontFamily;return n(t)?t:e(t)},computeFontStyle:function(){var t=this.fontStyle;return n(t)?t:e(t)},computeFontVariant:function(){var t=this.fontVariant;return n(t)?t:e(t)},computeFontWeight:function(){var t=this.fontWeight;return n(t)?t:e(t)},computeColor:function(){var t=this.color;return n(t)?t:e(t)},keyedPopulatedWords:function(){return function(t,e,n,o,a,u,f,c,h){var l={};return t.forEach(function(t){var d,s,p,v,g,y,m,W,S;if(t)if("string"==typeof t)s=t;else if(Array.isArray(t)){var x;s=(x=t)[0],p=x[1]}else if(r(t)){var w;d=(w=t).key,s=w.text,p=w.weight,v=w.rotation,g=w.fontFamily,y=w.fontStyle,m=w.fontVariant,W=w.fontWeight,S=w.color}for(void 0===s&&(s=e(t)),void 0===p&&(p=n(t)),void 0===v&&(v=o(t)),void 0===g&&(g=a(t)),void 0===y&&(y=u(t)),void 0===m&&(m=f(t)),void 0===W&&(W=c(t)),void 0===S&&(S=h(t)),void 0===d&&(d=JSON.stringify([s,g,y,m,W]));i(l,d);)d+="!";l[d]={key:d,originalWord:t,text:s,weight:p,rotation:v,fontFamily:g,fontStyle:y,fontVariant:m,fontWeight:W,color:S}}),l}(this.words,this.computeText,this.computeWeight,this.computeRotation,this.computeFontFamily,this.computeFontStyle,this.computeFontVariant,this.computeFontWeight,this.computeColor)},populatedWords:function(){return Object.values(this.keyedPopulatedWords)},watch$boundableWords:function(){return function(t){return t.map(function(t){return{key:t.key,text:t.text,weight:t.weight,rotation:t.rotation,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontVariant:t.fontVariant,fontWeight:t.fontWeight}})}(this.populatedWords)},boundedWords:function(){return f(this.boundableWords,this.containerWidth,this.containerHeight,this.fontSizeRatio)},scaledBoundedWords:function(){return function(t,e,n,r){var o=c(t,function(t){return t.rectLeft}),i=h(t,function(t){return t.rectLeft+t.rectWidth}),a=i-o,u=c(t,function(t){return t.rectTop}),f=h(t,function(t){return t.rectTop+t.rectHeight}),l=f-u,d=Math.min(e/a,n/l),s=h(t,function(t){return t.fontSize})*d;return s>r&&(d*=r/s),t.map(function(t){var r=t.key,a=t.fontSize,c=t.textWidth,h=t.textHeight,l=t.rectLeft,s=t.rectTop,p=t.rectWidth,v=t.rectHeight;return a*=d,c*=d,h*=d,l=(l-(o+i)/2)*d+e/2,s=(s-(u+f)/2)*d+n/2,p*=d,v*=d,{key:r,fontSize:a,textWidth:c,textHeight:h,rectLeft:l,rectTop:s,rectWidth:p,rectHeight:v}})}(this.boundedWords,this.containerWidth,this.containerHeight,this.maxFontSize)},startToUpdateContainerSize:function(){return function(){var t=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){t.startToUpdateContainerSize()})},this.intervalBetweenUpdateContainerSize),this.updateContainerSize())}}},watch:{watch$boundableWords:{handler:function(t,e){o(t,e)||(this.boundableWords=Object.freeze(t))},immediate:!0}},methods:{updateContainerSize:function(){var t=this.$el.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n}}};return"undefined"!=typeof window&&t.component(l.name,l),l});
